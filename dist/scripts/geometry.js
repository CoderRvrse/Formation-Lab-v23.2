var b=Object.defineProperty;var c=(e,n)=>b(e,"name",{value:n,configurable:!0});import{FLAB as y}from"./state.js";function i(e,n=0){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const t=parseFloat(e);return Number.isFinite(t)?t:n}return n}c(i,"safeNumber");function D(e,n,t,o=0){const r=i(e,0),s=i(n,0),u=t(r,s);return Number.isFinite(u)?u:o}c(D,"safeMath");function _(e,n){const t=i(e,0),o=i(n,0),r=Math.sqrt(t*t+o*o);return Number.isFinite(r)&&r>0?r:1}c(_,"safeHypot");function q(e,n=0){const t=parseFloat(e);return Number.isFinite(t)?t:n}c(q,"cssNumber");function F(e,n=0){return q(getComputedStyle(document.documentElement).getPropertyValue(e),n)}c(F,"getVar");function R(e,n,t,o){const r=t-e,s=o-n,u=_(r,s);return{ux:r/u,uy:s/u}}c(R,"unit");function v(e,n,t,o,r){const{ux:s,uy:u}=R(e,n,t,o);return{x:e+s*r,y:n+u*r}}c(v,"insetFromA");function A(e,n,t,o,r){const{ux:s,uy:u}=R(t,o,e,n);return{x:t+s*r,y:o+u*r}}c(A,"insetFromB");const E=c((e,n,t)=>e+(n-e)*t,"mix"),Y=c((e,n,t)=>({x:E(e.x,n.x,t),y:E(e.y,n.y,t)}),"mixPt");function J(e,n,t){const o=Math.min(1,Math.max(0,(t-e)/(n-e)));return o*o*(3-2*o)}c(J,"smoothstep");function N(e,n){return y.orientation==="landscape"?{vx:e,vy:n}:{vx:n,vy:1-e}}c(N,"normToView");function C(e,n){return y.orientation==="landscape"?{nx:e,ny:n}:{nx:1-n,ny:e}}c(C,"viewToNorm");const S={landscape:{left:24,right:24,top:24,bottom:24},portrait:{left:24,right:24,top:28,bottom:28}};function H(){return document.querySelector(".flab-field")?.classList.contains("is-portrait")}c(H,"isPortrait");function h(){const e=document.querySelector(".flab-field"),n=i(e?.clientWidth,800),t=i(e?.clientHeight,600),o=H()?S.portrait:S.landscape;return{x:i(o.left,0),y:i(o.top,0),w:Math.max(1,i(n-o.left-o.right,100)),h:Math.max(1,i(t-o.top-o.bottom,100))}}c(h,"playableRect");function K(e,n){const t=h(),o=i(e,.5),r=i(n,.5);return{x:i(t.x+o*t.w,t.x+t.w/2),y:i(t.y+r*t.h,t.y+t.h/2)}}c(K,"n2p");function O(e,n){const t=h(),o=i(e,t.x+t.w/2),r=i(n,t.y+t.h/2);return{nx:i((o-t.x)/t.w,.5),ny:i((r-t.y)/t.h,.5)}}c(O,"p2n");function I(e,n){const{vx:t,vy:o}=N(e,n),r=h();return{x:i(r.x+t*r.w,r.x+r.w/2),y:i(r.y+o*r.h,r.y+r.h/2)}}c(I,"n2p_view");function P(e,n){const t=h(),o=i((e-t.x)/t.w,.5),r=i((n-t.y)/t.h,.5);return C(o,r)}c(P,"p2n_view");function Q(e,n){const t=h(),o=Math.min(t.x+t.w,Math.max(t.x,e)),r=Math.min(t.y+t.h,Math.max(t.y,n));return{x:o,y:r}}c(Q,"clampPx");function U(e,n){let t=document.getElementById("flabHalo");if(!t){console.warn("Creating fallback halo element"),t=document.createElement("div"),t.id="flabHalo",t.className="flab-halo",t.style.cssText="position:absolute;width:56px;height:56px;pointer-events:none;opacity:0;";const M=document.getElementById("formationField");M&&M.appendChild(t)}const o=i(e?.x,400),r=i(e?.y,300),s=i(n?.x,400),u=i(n?.y,300),g=i(t&&t.offsetWidth?t.offsetWidth/2:28,28),w=i(F("--pass-origin-gap",1.5),1.5),B=i(F("--pass-target-gap",2),2),m=v(o,r,s,u,g+w),a=document.querySelector('.player[data-id="'+(y?.selectedId??"")+'"]'),d=i(a?Math.max(a.offsetWidth,a.offsetHeight)/2:28,28),x=A(o,r,s,u,d+B),f=i(m.x,o),l=i(m.y,r),p=i(x.x,s),T=i(x.y,u);return{A:{x:Math.round(f)+.5,y:Math.round(l)+.5},B:{x:Math.round(p)+.5,y:Math.round(T)+.5}}}c(U,"tightEndpointsFromHalo");function L(){return document.querySelector(".flab-field")?.getBoundingClientRect()}c(L,"fieldRect");function Z(e){const n=L();if(!n||!e)return{x:0,y:0};const t=e.getBoundingClientRect();return{x:t.left-n.left+t.width/2,y:t.top-n.top+t.height/2}}c(Z,"centerInField");function V(){const n=document.querySelector(".flab-field")?.getBoundingClientRect();return{w:n?.width||0,h:n?.height||0}}c(V,"fieldSize");function $(){const n=document.querySelector(".flab-field")?.getBoundingClientRect();return{width:n?.width||400,height:n?.height||300,x:0,y:0}}c($,"getFieldBBox");function W(e,n,t,o,r,s){const a=c((f,l)=>(f<0?1:0)|(f>r?2:0)|(l<0?8:0)|(l>s?4:0),"code");let d=a(e,n),x=a(t,o);for(;;){if(!(d|x))return{ax:e,ay:n,bx:t,by:o,visible:!0};if(d&x)return{ax:e,ay:n,bx:t,by:o,visible:!1};const f=d||x;let l,p;f&8?(l=e+(t-e)*(0-n)/(o-n),p=0):f&4?(l=e+(t-e)*(s-n)/(o-n),p=s):f&2?(p=n+(o-n)*(r-e)/(t-e),l=r):(p=n+(o-n)*(0-e)/(t-e),l=0),f===d?(e=l,n=p,d=a(e,n)):(t=l,o=p,x=a(t,o))}}c(W,"clipSegmentToRect");function G(e,n){const t=document.getElementById("pitchMount");if(!t)return console.warn("toView: pitchMount not found, using defaults"),{x:e,y:n};const o=t.getBoundingClientRect(),r=e-o.left,s=n-o.top;return{x:r,y:s}}c(G,"toView");function j(e,n){if(typeof e=="object"&&e!==null)return j(e.x,e.y);const t=P(e,n);return{x:t.nx,y:t.ny}}c(j,"viewToField"),window.__mod_geometry=!0,window.__geom_api={playableRect:h,n2p_view:I,normToView:N,fieldSize:V,clipSegmentToRect:W,toView:G};export{Z as centerInField,Q as clampPx,W as clipSegmentToRect,q as cssNumber,L as fieldRect,V as fieldSize,$ as getFieldBBox,F as getVar,v as insetFromA,A as insetFromB,E as mix,Y as mixPt,K as n2p,I as n2p_view,N as normToView,O as p2n,P as p2n_view,h as playableRect,J as smoothstep,U as tightEndpointsFromHalo,G as toView,R as unit,j as viewToField,C as viewToNorm};
//# sourceMappingURL=geometry.js.map
