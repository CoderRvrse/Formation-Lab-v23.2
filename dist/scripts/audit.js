var A=Object.defineProperty;var c=(r,m)=>A(r,"name",{value:m,configurable:!0});async function R(){const r=window.FLAB_VERSION||"v?",m=[],e=c((t,s)=>m.push({ok:!!t,msg:s}),"ok"),k=c(t=>typeof t<"u"&&t!==null,"has");e(!!window.FLAB,"state.js loaded (window.FLAB exists)"),e(!!window.__mod_state,"state module marker"),e(!!window.__mod_geometry,"geometry module marker"),e(!!window.__mod_orientation,"orientation module marker"),e(!!window.__mod_drag,"drag module marker"),e(!!window.__mod_pass,"pass module marker"),e(!!window.__mod_render,"render module marker"),e(!!window.__mod_export,"export module marker"),e(!!window.__mod_ui,"ui module marker"),e(!!window.__mod_keyboard,"keyboard module marker"),e(!!window.__mod_presets,"presets module marker"),e(!!window.__mod_persist,"persist module marker"),e(!!window.__mod_logger,"logger module marker"),e(!!window.__mod_presetmenu,"preset dropdown menu marker"),e(!!window.__mod_erasemenu,"erase dropdown menu marker"),e(!!document.querySelector(".flab-field"),".flab-field exists"),e(!!document.getElementById("arrow-layer"),"#arrow-layer exists"),e(getComputedStyle(document.getElementById("arrow-layer")).pointerEvents==="none","#arrow-layer pointer-events:none"),e(!!document.getElementById("flabHalo"),"#flabHalo exists");const P=[...document.styleSheets].map(t=>t.href||"").find(t=>t.includes("styles/main.css"));if(e(!!P&&/\?v=/.test(P),"main.css loaded with ?v="),"serviceWorker"in navigator)try{const s=((await fetch("sw.js",{cache:"no-store"}).then(a=>a.text())).match(/CACHE_VERSION\s*=\s*['"]([^'"]+)['"]/)||[])[1];e(!!s,"sw.js has CACHE_VERSION"),e(s===r,`SW CACHE_VERSION matches app (${s} == ${r})`)}catch{e(!0,"SW check skipped (dev)")}const n=document.querySelector("#arrow-layer defs");e(!!n&&n.querySelector("#passHead-solid"),"marker passHead-solid present"),e(!!n&&n.querySelector("#passHead-comic-flat"),"marker passHead-comic-flat present"),e(!!n&&n.querySelector("#passHead-comic-halftone"),"marker passHead-comic-halftone present");const I=document.getElementById("flabHalo");e(Number.isFinite((I?.offsetWidth||0)/2),"halo radius finite");const p=(window.FLAB.players||[])[0]||{nx:.5,ny:.5},u=window.__geom_api;if(u){const t=u.normToView(p.nx,p.ny),s=u.n2p_view(p.nx,p.ny);e(k(t.vx)&&k(t.vy),"normToView emits vx,vy"),e(Number.isFinite(s.x)&&Number.isFinite(s.y),"n2p_view returns finite px")}else e(!1,"geometry API not exposed for audit");const _=u?.playableRect?.();e(!!_&&_.w>0&&_.h>0,"playableRect positive");const g=document.querySelector(".player");e(!!g,"at least one .player in DOM"),g&&e(getComputedStyle(g).pointerEvents==="auto",".player receives events"),e(!("state"in window)||window.state===window.FLAB,"no stray global state (or alias bound)");try{const t=await fetch("sw.js",{cache:"no-store"}).then(s=>s.text());["scripts/main.js","scripts/state.js","scripts/geometry.js","scripts/orientation.js","scripts/drag.js","scripts/pass.js","scripts/render.js","scripts/export.js","scripts/ui.js","scripts/keyboard.js","scripts/presets.js"].forEach(s=>e(t.includes(s),`sw precache includes ${s}`))}catch{}e(!!window.__PITCH&&!!window.__PITCH.PITCH_LAND,"PITCH_LAND constant available"),e(!!window.__PITCH&&!!window.__PITCH.PITCH_PORT,"PITCH_PORT constant available");const w=document.documentElement.outerHTML.match(/assets\/[^"']*pitch-[^"']*/g)||[],S=w.filter(t=>t.includes("--pitch-url")||t.includes("CSS variable")||t.includes("../../assets/")||t.includes("&quot;);"));e(w.length===0||S.length===w.length,`No stray pitch asset refs (found ${w.length-S.length} violations)`);const H=document.querySelectorAll("[data-keydown-listener]");e(H.length===0,"No duplicate keydown listeners in DOM"),e(typeof window.__mod_presets<"u","Presets module available");const x=[];if(document.addEventListener("keydown",()=>x.push(1),{once:!0}),e(x.length<=1,"Single global keydown handler"),window.__mod_persist)try{const s=(await import("./persist.js"))._testRoundTrip();e(s,"Settings persistence round-trip test")}catch(t){e(!1,`Settings persistence test failed: ${t.message}`)}if(window.__geom_api){const{normToView:t}=window.__geom_api,s=t(.25,.75);window.FLAB.orientation==="portrait"?e(Math.abs(s.vx-.75)<.01&&Math.abs(s.vy-.75)<.01,"Portrait view transform accuracy"):e(Math.abs(s.vx-.25)<.01&&Math.abs(s.vy-.75)<.01,"Landscape view transform accuracy")}const E=[...document.querySelectorAll("#arrow-layer *")].some(t=>t.getAttribute?["d","x1","y1","x2","y2","markerWidth","markerHeight","refX","refY","viewBox"].some(a=>{const i=t.getAttribute(a)||"";return/NaN/.test(i)}):!1);e(!E,"No NaN values in SVG arrow layer attributes");try{const{savePreset:t,getPreset:s,setDefaultPreset:a,getDefaultPresetName:i,deletePreset:v}=await import("./storage.js"),{snapshotCurrentPlayersCanonical:l,applyPlayersCanonical:d}=await import("./presets.js");e(typeof l=="function","preset snapshot fn present");const f=l(),o="__audit_preset__";t(o,f),e(!!s(o),"preset saved"),a(o),e(i()===o,"default preset set"),d(s(o).players),v(o),e(!s(o),"preset deleted")}catch(t){e(!1,`Preset functionality test failed: ${t.message}`)}try{const{exportTelemetrySnapshot:t}=await import("./logger.js");e(typeof t=="function","logger telemetry export function present");const s=t();e(!!s.timestamp&&!!s.version,"telemetry snapshot generates valid data")}catch(t){e(!1,`Logger functionality test failed: ${t.message}`)}const h=document.getElementById("ui-portal"),L=document.getElementById("btnManagePresets");e(!!h,"UI portal element present"),e(!!L,"manage presets button present"),e(getComputedStyle(h).zIndex==="10000","UI portal has z-index 10000"),e(getComputedStyle(h).position==="fixed","UI portal uses fixed positioning");try{const{ensureBallLayer:t,preloadBall:s,isPlaying:a}=await import("./animate.js");e(typeof t=="function","ensureBallLayer function present"),e(typeof s=="function","preloadBall function present"),e(typeof a=="function","isPlaying function present");const i=document.getElementById("ball-layer");e(!!i,"#ball-layer present at boot"),window.__lastPass=null,window.addEventListener("flab:pass",d=>window.__lastPass=d.detail);const{getAllPassIds:v}=await import("./pass.js"),l=v();if(l.length>0){const{playPass:d}=await import("./animate.js");let f=!1;const o=c(()=>{f=!0},"startListener");window.addEventListener("flab:replay-start",o,{once:!0});const C=await d(l[0]);await new Promise(b=>setTimeout(b,100)),e(f,"ball playback can start"),e(a(),"isPlaying() returns true during playback"),C.stop("audit-test"),await new Promise(b=>setTimeout(b,50)),e(!a(),"isPlaying() returns false after stop"),window.removeEventListener("flab:replay-start",o)}}catch(t){e(!1,`Ball animation test failed: ${t.message}`)}if(new URLSearchParams(window.location.search).get("sw")==="off"){const t=await navigator.serviceWorker?.getRegistrations()||[];e(t.length===0,"Service Worker bypass active (?sw=off)"),console.log("\u{1F6A8} Running in SW bypass mode - offline caching disabled")}else e("serviceWorker"in navigator,"Service Worker API available");console.groupCollapsed(`Formation Lab ${r} \u2014 Modularization Audit`);let y=!0;for(const t of m)y=y&&t.ok,(t.ok?console.log:console.error)(t.ok?"\u2705":"\u274C",t.msg);return console.groupEnd(),y||console.warn("Audit had failures \u2014 see list above"),y}c(R,"runAudit");export{R as runAudit};
//# sourceMappingURL=audit.js.map
