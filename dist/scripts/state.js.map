{
  "version": 3,
  "sources": ["../../scripts/state.js"],
  "sourcesContent": ["// State module for Formation Lab\r\n// Hardened number utilities\r\nfunction safeNumber(v, def=0) {\r\n  if (typeof v === 'number' && Number.isFinite(v)) return v;\r\n  if (typeof v === 'string') {\r\n    const n = parseFloat(v);\r\n    return Number.isFinite(n) ? n : def;\r\n  }\r\n  return def;\r\n}\r\n\r\n// Global runtime state with safe defaults\r\nexport const FLAB = (window.FLAB = window.FLAB || {\r\n  version: window.FLAB_VERSION || 'v23.4',\r\n  mode: 'select',                // 'select' | 'pass' | 'erase'\r\n  orientation: 'landscape',      // 'landscape' | 'portrait'\r\n  passStyle: 'solid',            // 'solid' | 'dashed' | 'comic-flat' | 'comic-halftone'\r\n  passWidth: safeNumber(window.FLAB?.passWidth, 4),\r\n  players: [],                   // {id, role, nx, ny, ...}\r\n  arrows: [],                    // current saved arrows\r\n  selectedId: null,\r\n  drag: null,\r\n  passArm: null,\r\n  previewPath: null,\r\n  arrowCounter: safeNumber(window.FLAB?.arrowCounter, 1),\r\n  lastPassId: null               // last committed pass for \"Play Last\" functionality\r\n});\r\n\r\n// Preserve existing properties if they already exist\r\nFLAB.passStyle = FLAB.passStyle || 'solid';\r\nFLAB.passWidth = safeNumber(FLAB.passWidth, 4);\r\nFLAB.orientation = FLAB.orientation || 'landscape';\r\nFLAB.mode = FLAB.mode || 'select';\r\nFLAB.players = FLAB.players || [];\r\nFLAB.arrows = FLAB.arrows || [];\r\nFLAB.selectedId = FLAB.selectedId || null;\r\nFLAB.drag = FLAB.drag || null;\r\nFLAB.passArm = FLAB.passArm || null;\r\nFLAB.previewPath = FLAB.previewPath || null;\r\nFLAB.arrowCounter = safeNumber(FLAB.arrowCounter, 1);\r\n\r\n// Simple helpers (no reactivity framework)\r\nexport const set = (k, v) => { FLAB[k] = v; return FLAB; };\r\nexport const get = (k) => FLAB[k];\r\n\r\n// Player utilities\r\nexport const getPlayer = (id) => FLAB.players.find(p => p.id.toString() === id.toString());\r\n\r\n// Aim-assist configuration\r\nexport const AIM = {\r\n  enabled: true,   // internal only\r\n  radius: 80,      // px, view-space\r\n  hysteresis: 18,  // px beyond radius to unlock\r\n  delay: 60        // ms before lock promotion\r\n};\r\n\r\n// one live aim session per drag - attached to FLAB for easy access\r\nif (!window.FLAB.aim) {\r\n  window.FLAB.aim = {\r\n    candidateId: null,\r\n    lockedId: null,\r\n    showAt: 0\r\n  };\r\n}\r\n\r\n// Legacy export for compatibility\r\nexport const aimState = window.FLAB.aim;\r\n\r\n// Pass styling configuration\r\r\nconst existingPass = window.PASS || {};\r\r\nexport const PASS = Object.assign(existingPass, {\r\r\n  style: existingPass.style || FLAB.passStyle || 'solid',\r\r\n  color: existingPass.color || '#ffd166',\r\r\n  outline: existingPass.outline || '#1d1300',\r\r\n  recent: Array.isArray(existingPass.recent) ? existingPass.recent.slice(0, 3) : []\r\r\n});\r\r\nwindow.PASS = PASS;\r\r\n\r\r\n// Legacy aim state - replaced by aimState export\r\n\r\n// Pass style definitions (3 styles matching our arrow SVGs)\r\nexport const PASS_STYLES = [\r\n  { key: 'solid', label: 'Solid', asset: 'assets/arrows/head-solid.svg' },\r\n  { key: 'comic-flat', label: 'Comic Flat', asset: 'assets/arrows/head-comic-flat.svg' },\r\n  { key: 'comic-halftone', label: 'Comic Halftone', asset: 'assets/arrows/head-comic-halftone.svg' },\r\n];\r\n\r\n// Canonical head registry with proper sizing specifications\r\nexport const HEADS = /** @type {const} */ ({\r\n  'solid':         { key:'solid',         file:'assets/arrows/head-solid.svg',         baseSize: 24, overlap: 2 },\r\n  'comic-flat':    { key:'comic-flat',    file:'assets/arrows/head-comic-flat.svg',    baseSize: 24, overlap: 2 },\r\n  'comic-halftone':{ key:'comic-halftone', file:'assets/arrows/head-comic-halftone.svg',baseSize: 24, overlap: 2 },\r\n});\r\n\r\nexport function headSpec(style){ return HEADS[style] ?? HEADS['solid']; }\r\n\r\n// Pitch asset paths (single source of truth)\r\nexport const PITCH_LAND = 'assets/landscape/pitch-landscape.svg';\r\nexport const PITCH_PORT = 'assets/portrait/pitch-portrait.svg';\r\nexport const BALL_SVG = 'assets/balls/Soccer-ball-1.svg';\r\n\r\n// Assets object for global access\r\nFLAB.assets = FLAB.assets || {\r\n  ballUrl: BALL_SVG\r\n};\r\n\r\nwindow.__PITCH = { PITCH_LAND, PITCH_PORT }; // dev visibility\r\n\r\n// Legacy alias for backward compatibility\r\nwindow.state = FLAB;\r\n\r\nwindow.__mod_state = true;"],
  "mappings": "+EAEA,SAASA,EAAWC,EAAGC,EAAI,EAAG,CAC5B,GAAI,OAAOD,GAAM,UAAY,OAAO,SAASA,CAAC,EAAG,OAAOA,EACxD,GAAI,OAAOA,GAAM,SAAU,CACzB,MAAME,EAAI,WAAWF,CAAC,EACtB,OAAO,OAAO,SAASE,CAAC,EAAIA,EAAID,CAClC,CACA,OAAOA,CACT,CAPSE,EAAAJ,EAAA,cAUF,MAAMK,EAAQ,OAAO,KAAO,OAAO,MAAQ,CAChD,QAAS,OAAO,cAAgB,QAChC,KAAM,SACN,YAAa,YACb,UAAW,QACX,UAAWL,EAAW,OAAO,MAAM,UAAW,CAAC,EAC/C,QAAS,CAAC,EACV,OAAQ,CAAC,EACT,WAAY,KACZ,KAAM,KACN,QAAS,KACT,YAAa,KACb,aAAcA,EAAW,OAAO,MAAM,aAAc,CAAC,EACrD,WAAY,IACd,EAGAK,EAAK,UAAYA,EAAK,WAAa,QACnCA,EAAK,UAAYL,EAAWK,EAAK,UAAW,CAAC,EAC7CA,EAAK,YAAcA,EAAK,aAAe,YACvCA,EAAK,KAAOA,EAAK,MAAQ,SACzBA,EAAK,QAAUA,EAAK,SAAW,CAAC,EAChCA,EAAK,OAASA,EAAK,QAAU,CAAC,EAC9BA,EAAK,WAAaA,EAAK,YAAc,KACrCA,EAAK,KAAOA,EAAK,MAAQ,KACzBA,EAAK,QAAUA,EAAK,SAAW,KAC/BA,EAAK,YAAcA,EAAK,aAAe,KACvCA,EAAK,aAAeL,EAAWK,EAAK,aAAc,CAAC,EAG5C,MAAMC,EAAMF,EAAA,CAACG,EAAGN,KAAQI,EAAKE,CAAC,EAAIN,EAAUI,GAAhC,OACNG,EAAMJ,EAACG,GAAMF,EAAKE,CAAC,EAAb,OAGNE,EAAYL,EAACM,GAAOL,EAAK,QAAQ,KAAKM,GAAKA,EAAE,GAAG,SAAS,IAAMD,EAAG,SAAS,CAAC,EAAhE,aAGZE,EAAM,CACjB,QAAS,GACT,OAAQ,GACR,WAAY,GACZ,MAAO,EACT,EAGK,OAAO,KAAK,MACf,OAAO,KAAK,IAAM,CAChB,YAAa,KACb,SAAU,KACV,OAAQ,CACV,GAIK,MAAMC,EAAW,OAAO,KAAK,IAI9BC,EAAe,OAAO,MAAQ,CAAC,EAExBC,EAAO,OAAO,OAAOD,EAAc,CAE9C,MAAOA,EAAa,OAAST,EAAK,WAAa,QAE/C,MAAOS,EAAa,OAAS,UAE7B,QAASA,EAAa,SAAW,UAEjC,OAAQ,MAAM,QAAQA,EAAa,MAAM,EAAIA,EAAa,OAAO,MAAM,EAAG,CAAC,EAAI,CAAC,CAElF,CAAC,EAED,OAAO,KAAOC,EAOP,MAAMC,EAAc,CACzB,CAAE,IAAK,QAAS,MAAO,QAAS,MAAO,8BAA+B,EACtE,CAAE,IAAK,aAAc,MAAO,aAAc,MAAO,mCAAoC,EACrF,CAAE,IAAK,iBAAkB,MAAO,iBAAkB,MAAO,uCAAwC,CACnG,EAGaC,EAA8B,CACzC,MAAiB,CAAE,IAAI,QAAiB,KAAK,+BAAwC,SAAU,GAAI,QAAS,CAAE,EAC9G,aAAiB,CAAE,IAAI,aAAiB,KAAK,oCAAwC,SAAU,GAAI,QAAS,CAAE,EAC9G,iBAAiB,CAAE,IAAI,iBAAkB,KAAK,wCAAwC,SAAU,GAAI,QAAS,CAAE,CACjH,EAEO,SAASC,EAASC,EAAM,CAAE,OAAOF,EAAME,CAAK,GAAKF,EAAM,KAAU,CAAxDb,EAAAc,EAAA,YAGT,MAAME,EAAa,uCACbC,EAAa,qCACbC,EAAW,iCAGxBjB,EAAK,OAASA,EAAK,QAAU,CAC3B,QAASiB,CACX,EAEA,OAAO,QAAU,CAAE,WAAAF,EAAY,WAAAC,CAAW,EAG1C,OAAO,MAAQhB,EAEf,OAAO,YAAc",
  "names": ["safeNumber", "v", "def", "n", "__name", "FLAB", "set", "k", "get", "getPlayer", "id", "p", "AIM", "aimState", "existingPass", "PASS", "PASS_STYLES", "HEADS", "headSpec", "style", "PITCH_LAND", "PITCH_PORT", "BALL_SVG"]
}
