{
  "version": 3,
  "sources": ["../../scripts/pass.js"],
  "sourcesContent": ["// Pass module for Formation Lab\nimport { FLAB, AIM, aimState, headSpec, HEADS, PASS } from './state.js';\nimport { HEAD_OVERLAP, computeHeadScale } from './assets.arrows.js';\nimport { centerInField, fieldSize, clipSegmentToRect, getVar, insetFromA, insetFromB, viewToField } from './geometry.js';\nimport { playerEl, clearAimTags } from './render.js';\nimport { ensureHeadMarker, rebuildAllMarkers } from './pass.markers.js';\nimport { headPxFor, headTrimPx } from './pass.headsize.js';\nimport { getArrowSvg, ensureGroup } from './svgroot.js';\nimport { logPass } from './logger.js';\nimport { saveUndoState } from './undo-redo.js';\n\n// Helper to get CSS variable in pixels\nfunction getVarPx(varName, fallback = 0) {\n  const val = getComputedStyle(document.documentElement).getPropertyValue(varName);\n  return parseFloat(val) || fallback;\n}\n\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\nconst PASS_STYLES = ['solid', 'comic-flat', 'comic-halftone'];\n\n// Hardened number utilities\nfunction safeNumber(v, def=0) {\n  if (typeof v === 'number' && Number.isFinite(v)) return v;\n  if (typeof v === 'string') {\n    const n = parseFloat(v);\n    return Number.isFinite(n) ? n : def;\n  }\n  return def;\n}\n\n// Use overlap values from asset specifications\nfunction headOverlapFor(style){ return headSpec(style).overlap ?? 2; }\n\n/**\n * Positions and rotates a head group so its base sits at the end of `shaftPath`,\n * oriented along the path tangent. Uses small overlap to hide seams.\n *\n * @param {SVGPathElement} shaftPath - the visible shaft (<path>) on screen\n * @param {SVGGElement} headGroup     - the group containing the head graphic\n * @param {string} style              - current pass style (solid/comic-flat/comic-halftone)\n */\nexport async function attachPassHead(shaftPath, style) {\n  if (!shaftPath) return;\n\n  const L = shaftPath.getTotalLength();\n  const overlap = (HEAD_OVERLAP?.[style] ?? 2);\n\n  // headBaseLen is exactly where the ball stops too\n  const baseLen = Math.max(0, L - overlap);\n  shaftPath.dataset.headBaseLen = String(baseLen);\n\n  // Use the clean simple-markers system with improved error handling\n  const { attachHead } = await import('../assets/arrows/simple-markers.js');\n\n  try {\n    // attachHead now handles all timing internally with retries\n    const result = await attachHead(shaftPath, `head-${style}`);\n    if (result instanceof Promise) {\n      await result;\n    }\n    console.log(`\uD83C\uDFAF Head attached: style=${style}, baseLen=${baseLen.toFixed(1)}px`);\n  } catch (error) {\n    // For preview paths that might not be fully attached, try silent fallback\n    try {\n      if (shaftPath.setAttribute) {\n        shaftPath.setAttribute('marker-end', `url(#head-${style})`);\n        shaftPath.setAttribute('vector-effect', 'non-scaling-stroke');\n        console.log(`\uD83C\uDFAF Head attached (silent fallback): style=${style}`);\n      }\n    } catch (fallbackError) {\n      // Even fallback failed - this is likely a preview path that will be recreated\n      console.debug(`\u26A1 Preview path attachment skipped: ${error.message}`);\n    }\n  }\n}\n\n\n/**\n * Ensures the SVG markers are available for the given style\n * @param {string} style - pass style (solid, comic-flat, comic-halftone)\n */\nfunction ensurePassMarker(style) {\n  const svg = document.getElementById('arrow-layer');\n  if (!svg) return;\n\n  const marker = svg.querySelector(`#head-${style}`);\n  if (marker) return; // already exists\n\n  // Import and trigger marker creation if needed\n  import('./assets.arrows.js').then(({ preloadArrowHeads }) => {\n    preloadArrowHeads();\n  });\n}\n\n/**\n * Finalizes head positioning after shaft updates\n * @param {SVGGElement} passGroup - the pass group containing shaft and head\n * @param {string} style - current pass style\n */\nfunction finalizeHead(passGroup, style = FLAB.passStyle) {\n  if (!passGroup) return;\n\n  const shaft = passGroup.querySelector('.pass-shaft');\n  if (!shaft) return;\n\n  // Remove any old head groups - we're using markers now\n  const oldHead = passGroup.querySelector('.pass-head');\n  if (oldHead) {\n    oldHead.remove();\n  }\n\n  // Ensure marker exists and attach to shaft\n  ensurePassMarker(style);\n  attachPassHead(shaft, style);\n}\n\n// Precision endpoint computation for field-local coordinates\nfunction unit(ax, ay, bx, by) {\n  const dx = bx - ax, dy = by - ay;\n  const d = Math.hypot(dx, dy) || 1;\n  return { ux: dx / d, uy: dy / d, d };\n}\n\n// Helper functions\nfunction getPlayer(playerId) {\n  return FLAB.players.find(player => player.id === playerId) || null;\n}\n\nfunction getPlayerEl(playerId) {\n  return document.querySelector(`.player[data-id=\"${playerId}\"]`);\n}\n\nfunction snapHalf(p) {\n  p.x = Math.round(p.x) + 0.5;\n  p.y = Math.round(p.y) + 0.5;\n  return p;\n}\n\nfunction haloRadiusPx() {\n  const h = document.getElementById('flabHalo');\n  return ((h?.offsetWidth) || 56) / 2;\n}\n\nfunction tokenRadiusPx(el) {\n  // jersey button size \u2248 its min dimension /2; fallback to 28\n  const r = el?.getBoundingClientRect();\n  return Math.max(14, Math.min(r?.width || 56, r?.height || 56) / 2);\n}\n\n// Helper to get player view coordinates\nfunction getPlayerViewCoords(player) {\n  const el = document.querySelector(`.player[data-id=\"${player.id}\"]`);\n  if (!el) return null;\n\n  const rect = el.getBoundingClientRect();\n  const fieldRect = document.getElementById('pitchMount').getBoundingClientRect();\n  return {\n    x: rect.left + rect.width / 2 - fieldRect.left,\n    y: rect.top + rect.height / 2 - fieldRect.top\n  };\n}\n\n// Find nearest player in view space (exclude passer)\nfunction nearestPlayerView(x, y, excludeId) {\n  let best = null, bestDist = Infinity;\n  for (const p of FLAB.players) {\n    if (p.id === excludeId) continue;\n    const pView = getPlayerViewCoords(p);\n    if (!pView) continue;\n    const d = Math.hypot(pView.x - x, pView.y - y);\n    if (d < bestDist) {\n      best = p;\n      bestDist = d;\n    }\n  }\n  return { player: best, dist: bestDist };\n}\n\nexport function computePassEndpoints(passerEl, targetEl) {\n  const startGap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pass-origin-gap')) || 1.5;\n  const endGap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pass-target-gap')) || 2;\n\n  // Centers in **field-local** pixels\n  const A0 = centerInField(passerEl);\n  const B0 = centerInField(targetEl);\n\n  const startInset = haloRadiusPx() + startGap;\n  const endInset = tokenRadiusPx(targetEl) + endGap;\n\n  let A = insetFromA(A0.x, A0.y, B0.x, B0.y, startInset);\n  let B = insetFromB(A0.x, A0.y, B0.x, B0.y, endInset);\n\n  // Minimum visible length guard\n  const { d, ux, uy } = unit(A.x, A.y, B.x, B.y);\n  const minLen = 12;\n  if (d < minLen) {\n    const cx = (A.x + B.x) / 2, cy = (A.y + B.y) / 2, half = minLen / 2;\n    A = { x: cx - ux * half, y: cy - uy * half };\n    B = { x: cx + ux * half, y: cy + uy * half };\n  }\n\n  return { A: snapHalf(A), B: snapHalf(B) };\n}\n\n// Compute clipped pass endpoints that stay within field bounds\nexport function computeClippedPass(A, B) {\n  const { w, h } = fieldSize();\n  const seg = clipSegmentToRect(A.x, A.y, B.x, B.y, w, h);\n  if (!seg.visible) return null; // nothing to draw\n  return { A: snapHalf({x: seg.ax, y: seg.ay}), B: snapHalf({x: seg.bx, y: seg.by}) };\n}\n\nfunction applyPassStyle(el, lengthPx = null) {\n  const s = FLAB.passStyle;\n  const cls = s.startsWith('comic') ? 'pass-comic' : 'pass-solid';\n  el.setAttribute('class', cls);\n\n  // Use length-aware markers if length is provided\n  if (lengthPx !== null) {\n    const arrowLayer = document.getElementById('arrow-layer');\n    const defs = arrowLayer?.querySelector('defs');\n    if (defs) {\n      const markerId = ensureHeadMarker(defs, s, lengthPx);\n      if (markerId) {\n        el.setAttribute('marker-end', `url(#${markerId})`);\n        return;\n      }\n    }\n  }\n\n  // Fallback to static markers\n  const markerId = s === 'solid' ? 'passHead-solid' : s === 'comic-flat' ? 'passHead-comic-flat' : 'passHead-comic-halftone';\n  el.setAttribute('marker-end', `url(#${markerId})`);\n}\n\n// Set arrow paths with clean shaft-head join\nfunction setArrowPaths(svgGroup, A, Btip, styleKey, lenPx, shaftClass) {\n  if (!svgGroup) return;\n  console.debug('setArrowPaths', A, Btip, svgGroup?.ownerSVGElement?.id);\n\n  // Debug shaft disabled - using main shaft with CSS styling instead\n  // let shaft = svgGroup.querySelector('path.__debug');\n  // if (!shaft) {\n  //   shaft = document.createElementNS('http://www.w3.org/2000/svg','path');\n  //   shaft.setAttribute('class','__debug');\n  //   svgGroup.appendChild(shaft);\n  // }\n  // shaft.setAttribute('d', `M ${A.x} ${A.y} L ${Btip.x} ${Btip.y}`);\n  // shaft.setAttribute('fill','none');\n  // shaft.setAttribute('stroke', PASS.color || '#ffd166');\n  // shaft.setAttribute('stroke-width', FLAB.passWidth || 4);\n  // shaft.setAttribute('vector-effect','non-scaling-stroke');\n\n  const svgRoot = getArrowSvg();\n  const arrowGroup = document.getElementById('arrow-group');\n  if (!svgRoot || !arrowGroup) {\n    console.warn('setArrowPaths: no arrow SVG root or arrow-group');\n    return;\n  }\n\n  // If group is not in DOM or not under arrow-group, reattach it\n  if (!svgGroup || svgGroup.parentNode !== arrowGroup) {\n    if (!svgGroup) {\n      svgGroup = document.createElementNS(svgRoot.namespaceURI,'g');\n    }\n    arrowGroup.appendChild(svgGroup);\n  }\n\n  const defs = svgRoot.querySelector('defs'); // guaranteed by getArrowSvg()\n  const headId = ensureHeadMarker(defs, styleKey, lenPx);\n  const headPx = headPxFor(lenPx, /comic/.test(styleKey));\n  const trim = headTrimPx(headPx);\n\n  // Compute Bshaft = Btip moved back toward A by trim\n  const dx = Btip.x - A.x;\n  const dy = Btip.y - A.y;\n  const L = Math.hypot(dx, dy) || 1;\n  const Bshaft = {\n    x: Btip.x - dx * (trim / L),\n    y: Btip.y - dy * (trim / L)\n  };\n\n  // Clear previous content except debug shaft\n  Array.from(svgGroup.children).forEach(child => {\n    if (!child.classList.contains('shaft')) {\n      svgGroup.removeChild(child);\n    }\n  });\n\n  // 1) Visible shaft path (stops at Bshaft) - DIRECT COLOR APPLICATION\n  const mainShaft = document.createElementNS(SVG_NS, 'path');\n  mainShaft.classList.add('pass-shaft');\n  mainShaft.classList.add(shaftClass);\n  mainShaft.classList.add(`pass-${styleKey}`);\n  mainShaft.dataset.passStyle = styleKey;\n  mainShaft.setAttribute('vector-effect', 'non-scaling-stroke');\n  mainShaft.setAttribute('fill', 'none');\n  mainShaft.setAttribute('d', `M ${A.x} ${A.y} L ${Bshaft.x} ${Bshaft.y}`);\n\n  // Get color from multiple sources in priority order\n  let currentColor = '#ffd166'; // fallback\n\n  // Try CSS variable first\n  const cssVar = getComputedStyle(document.documentElement).getPropertyValue('--pass-color').trim();\n  if (cssVar) {\n    currentColor = cssVar;\n  }\n\n  // Try PASS.color if available\n  if (PASS?.color) {\n    currentColor = PASS.color;\n  }\n\n  // FORCE CSS VARIABLE UPDATE - This ensures the CSS variable is updated before creating shaft\n  document.documentElement.style.setProperty('--pass-color', currentColor);\n\n  // Also ensure PASS.color is synchronized\n  if (PASS) {\n    PASS.color = currentColor;\n  }\n\n  mainShaft.setAttribute('stroke', currentColor);\n  mainShaft.style.stroke = currentColor;\n  mainShaft.style.color = currentColor;\n  mainShaft.setAttribute('color', currentColor);\n\n  // Add shaft to DOM first so CSS rules can apply\n  svgGroup.appendChild(mainShaft);\n\n  // FORCE IMMEDIATE CSS RECALCULATION\n  // Since CSS has !important rules that override inline styles, we need to ensure the CSS variable is read correctly\n  getComputedStyle(mainShaft).stroke; // Force style calculation\n\n  // Ensure comic style uses solid stroke by clearing any dash pattern\n  if (shaftClass === 'pass-comic') {\n    mainShaft.removeAttribute('stroke-dasharray');\n  }\n\n  // DETAILED DEBUGGING - Check what actually got set AND monitor changes\n  let monitorCount = 0;\n  const monitorChanges = () => {\n    monitorCount++;\n    const actualStroke = mainShaft.getAttribute('stroke');\n    const computedStroke = getComputedStyle(mainShaft).stroke;\n    const hasStyleStroke = mainShaft.style.stroke;\n    console.log(`\uD83D\uDD0D SHAFT DEBUG (check ${monitorCount}):`);\n    console.log(`  - Intended color: ${currentColor}`);\n    console.log(`  - SVG stroke attribute: ${actualStroke}`);\n    console.log(`  - Computed stroke style: ${computedStroke}`);\n    console.log(`  - Inline style.stroke: ${hasStyleStroke}`);\n\n    if (monitorCount < 5) {\n      setTimeout(monitorChanges, 200); // Check again in 200ms\n    }\n\n    if (monitorCount === 1) {\n      console.log(`  - Element:`, mainShaft);\n    }\n  };\n\n  setTimeout(monitorChanges, 100);\n\n  // MUTATION OBSERVER - Watch for any changes to the shaft element\n  const observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && (mutation.attributeName === 'stroke' || mutation.attributeName === 'style')) {\n        console.log(`\uD83D\uDEA8 SHAFT MODIFIED by external code!`);\n        console.log(`  - Attribute changed: ${mutation.attributeName}`);\n        console.log(`  - New value: ${mainShaft.getAttribute(mutation.attributeName)}`);\n        console.log(`  - Current computed stroke: ${getComputedStyle(mainShaft).stroke}`);\n      }\n    });\n  });\n\n  observer.observe(mainShaft, {\n    attributes: true,\n    attributeFilter: ['stroke', 'style']\n  });\n\n  // Stop observing after 5 seconds\n  setTimeout(() => observer.disconnect(), 5000);\n\n  console.log(`\u2705 Shaft created with direct color: ${currentColor} (CSS: ${cssVar}, PASS: ${PASS?.color}), style: ${shaftClass}`);\n\n  // 2) Attach marker-based head to shaft\n  ensurePassMarker(styleKey);\n  attachPassHead(mainShaft, styleKey);\n\n  // Dash polish: ensure last dash doesn't peek under the head\n  mainShaft.style.strokeDashoffset = '';\n  mainShaft.style.strokeLinecap = 'butt';\n}\n\n\nfunction createPass({ id, fromId, to, curved = false, control = null }) {\n  const startPlayer = getPlayer(fromId);\n  if (!startPlayer) return null;\n\n  // Get DOM elements for precise field-local coordinates\n  const passerEl = document.querySelector(`.player[data-id=\"${fromId}\"]`);\n  if (!passerEl) return null;\n\n  // Create a temporary element at target position for endpoint calculation\n  const tempTarget = document.createElement('div');\n  tempTarget.style.cssText = `position:absolute;left:${to.x}px;top:${to.y}px;width:56px;height:56px;pointer-events:none;`;\n  document.querySelector('.flab-field').appendChild(tempTarget);\n\n  try {\n    // Use field-local precise endpoints\n    const { A, B } = computePassEndpoints(passerEl, tempTarget);\n\n    let pathData;\n    if (curved && control) {\n      // For curved passes, use the tight endpoints but keep the control point\n      const safeControlX = safeNumber(control.x, (A.x + B.x) / 2);\n      const safeControlY = safeNumber(control.y, (A.y + B.y) / 2);\n      pathData = `M ${A.x} ${A.y} Q ${safeControlX} ${safeControlY} ${B.x} ${B.y}`;\n    } else {\n      // For straight passes with clipping\n      const clipped = computeClippedPass(A, B);\n      if (clipped) {\n        pathData = `M ${clipped.A.x} ${clipped.A.y} L ${clipped.B.x} ${clipped.B.y}`;\n      } else {\n        pathData = \"\"; // Nothing to draw - completely outside field\n      }\n    }\n\n    // Only proceed if all coordinates are finite\n    if (!pathData.match(/NaN|Infinity|-Infinity/)) {\n\n      // Calculate pass length for size-aware markers\n      const lengthPx = Math.hypot(B.x - A.x, B.y - A.y);\n      const styleKey = FLAB.passStyle;\n      const shaftClass = styleKey.startsWith('comic') ? 'pass-comic' : 'pass-solid';\n\n      const group = document.createElementNS(SVG_NS, \"g\");\n      group.setAttribute(\"data-arrow-id\", String(id));\n      group.classList.add(\"svg-pass\");\n\n      // Use the new clean shaft-head join system\n      setArrowPaths(group, A, B, styleKey, lengthPx, shaftClass);\n\n      // Create hitbox for the full path\n      const hitbox = document.createElementNS(SVG_NS, \"path\");\n      hitbox.setAttribute(\"d\", pathData);\n      hitbox.classList.add(\"flab-arrow-hitbox\");\n      group.appendChild(hitbox);\n\n      return group;\n    } else {\n      console.warn('Rejected path with invalid coordinates:', pathData);\n      return null;\n    }\n  } finally {\n    // Clean up temporary target element\n    tempTarget.remove();\n  }\n}\n\n// called on pointerdown in Pass mode\nexport function beginPassPreview(passer) {\n  FLAB.passArm = { drawing: true, curved: false, latest: getPlayerViewCoords(passer) };\n  FLAB.activePlayer = passer;\n  FLAB.aim.candidateId = null;\n  FLAB.aim.lockedId = null;\n  FLAB.aim.showAt = 0;\n  clearAimTags();\n  FLAB.previewG = ensureGroup('pass-preview');\n  while (FLAB.previewG.firstChild) FLAB.previewG.removeChild(FLAB.previewG.firstChild);\n}\n\n// Helper to get shaft class for pass style\nfunction shaftClassFor(style) {\n  return style.startsWith('comic') ? 'pass-comic' : 'pass-solid';\n}\n\n// commit pass on pointerup\nexport function commitPass() {\n  if (!FLAB.passArm?.drawing) return;\n  const passer = FLAB.activePlayer;\n  if (!passer) return;\n\n  const cur = FLAB.passArm.latest;\n  const tgtGap = getVarPx('--pass-target-gap', 2);\n  const passerView = getPlayerViewCoords(passer);\n\n  let endV = cur;\n  if (FLAB.aim.lockedId) {\n    const t = getPlayer(FLAB.aim.lockedId);\n    const tView = getPlayerViewCoords(t);\n    if (passerView && tView) {\n      const targetR = 28;\n      endV = insetFromB(passerView.x, passerView.y, tView.x, tView.y, targetR + tgtGap);\n    }\n  }\n\n  commitArrow(passer.id, endV, FLAB.passArm.curved, FLAB.passArm.control);\n\n  // telemetry: log pass details for dev/analytics\n  const startField = viewToField(passerView);\n  const endField = viewToField(endV);\n\n  const style = FLAB.passStyle;\n  const width = FLAB.passWidth;\n  const color = PASS.color || '#ffd166';\n  const curved = !!FLAB.passArm?.curved;\n\n  const fromId = passer.id;\n  const fromNum = passer.number ?? passer.id;\n\n  // if we had a lock, we know the receiver; else \"free\" end (toId=null)\n  const lockedId = FLAB.aim?.lockedId ?? null;\n  const target = lockedId ? getPlayer(lockedId) : null;\n  const toId = target?.id ?? null;\n  const toNum = target?.number ?? target?.id ?? null;\n\n  const dx = endV.x - passerView.x;\n  const dy = endV.y - passerView.y;\n  const lengthPx = Math.hypot(dx, dy);\n\n  logPass({\n    fromId, toId, fromNum, toNum,\n    style, width, color, curved, lengthPx,\n    startField, endField\n  });\n\n  FLAB.passArm = null;\n\n  // cleanup\n  FLAB.aim.candidateId = FLAB.aim.lockedId = null;\n  clearAimTags();\n  while (FLAB.previewG?.firstChild) FLAB.previewG.removeChild(FLAB.previewG.firstChild);\n}\n\nexport function updatePassPreview(v) {\n  if (!FLAB.passArm?.drawing) return;\n  const passer = FLAB.activePlayer;\n  if (!passer) return;\n\n  // Handle null/undefined viewPt\n  if (!v || typeof v.x !== 'number' || typeof v.y !== 'number') {\n    return;\n  }\n\n  console.debug('[pass] move', v.x|0, v.y|0);\n\n  // track latest pointer\n  FLAB.passArm.latest = v;\n\n  // ----- aim acquisition -----\n  let cand = null;\n  if (AIM.enabled) {\n    const { player, dist } = nearestPlayerView(v.x, v.y, passer.id);\n    if (player && dist <= AIM.radius) cand = player;\n  }\n\n  const now = performance.now();\n\n  // hysteresis & promotion to lock\n  if (cand) {\n    if (FLAB.aim.lockedId) {\n      const lp = getPlayer(FLAB.aim.lockedId);\n      const lpView = getPlayerViewCoords(lp);\n      if (lpView) {\n        const d = Math.hypot(lpView.x - v.x, lpView.y - v.y);\n        if (d > AIM.radius + AIM.hysteresis) {\n          FLAB.aim.lockedId = null;\n          FLAB.aim.candidateId = cand.id;\n          FLAB.aim.showAt = now;\n        }\n      }\n    } else {\n      if (FLAB.aim.candidateId !== cand.id) {\n        FLAB.aim.candidateId = cand.id;\n        FLAB.aim.showAt = now;\n      } else if (now - FLAB.aim.showAt >= AIM.delay) {\n        FLAB.aim.lockedId = cand.id;\n      }\n    }\n  } else {\n    FLAB.aim.candidateId = null;\n    FLAB.aim.lockedId = null;\n  }\n\n  // ----- visual rings -----\n  clearAimTags();\n  if (FLAB.aim.candidateId && !FLAB.aim.lockedId) {\n    playerEl(FLAB.aim.candidateId)?.setAttribute('data-aim', 'pre');\n  }\n  if (FLAB.aim.lockedId) {\n    playerEl(FLAB.aim.lockedId)?.setAttribute('data-aim', 'lock');\n  }\n\n  // ----- geometry (halo-edge origin + snapped end if locked) -----\n  const haloR = (document.getElementById('flabHalo')?.offsetWidth || 0) / 2;\n  const startGap = getVarPx('--pass-origin-gap', 1.5);\n  const passerView = getPlayerViewCoords(passer);\n  if (!passerView) return;\n  const start = insetFromA(passerView.x, passerView.y, v.x, v.y, haloR + startGap);\n\n  let endX = v.x, endY = v.y;\n  const tgtGap = getVarPx('--pass-target-gap', 2);\n  const targetR = 28; // jersey visual radius\n\n  if (FLAB.aim.lockedId) {\n    const t = getPlayer(FLAB.aim.lockedId);\n    const tView = getPlayerViewCoords(t);\n    if (tView) {\n      const targetVecX = tView.x - passerView.x;\n      const targetVecY = tView.y - passerView.y;\n      const targetLenSq = targetVecX ** 2 + targetVecY ** 2;\n      if (targetLenSq > 0) {\n        const pointerVecX = v.x - passerView.x;\n        const pointerVecY = v.y - passerView.y;\n        const projection = (pointerVecX * targetVecX + pointerVecY * targetVecY) / targetLenSq;\n        if (projection > 1.05) {\n          FLAB.aim.lockedId = null;\n          FLAB.aim.candidateId = null;\n        } else {\n          const end = insetFromB(passerView.x, passerView.y, tView.x, tView.y, targetR + tgtGap);\n          endX = end.x;\n          endY = end.y;\n        }\n      }\n    }\n  }\n\n  // draw (debug shaft)\n  const len = Math.hypot(endX - start.x, endY - start.y);\n  setArrowPaths(FLAB.previewG, start, { x: endX, y: endY }, FLAB.passStyle, len, shaftClassFor(FLAB.passStyle));\n\n  // Finalize head positioning after preview update\n  finalizeHead(FLAB.previewG, FLAB.passStyle);\n}\n\n\nexport function commitArrow(fromId, point, curved = false, control = null) {\n  if (!point) return;\n\n  // Get locked target from aim state\n  const lockId = FLAB.aim?.lockedId ?? null;\n\n  // Determine final target position (either locked player or cursor)\n  let finalPoint = point;\n  const locked = lockId ? getPlayer(lockId) : null;\n  if (locked) {\n    const lockedEl = getPlayerEl(locked.id);\n    if (lockedEl) {\n      const rect = lockedEl.getBoundingClientRect();\n      const fieldRect = document.querySelector('.flab-field').getBoundingClientRect();\n      finalPoint = {\n        x: rect.left + rect.width / 2 - fieldRect.left,\n        y: rect.top + rect.height / 2 - fieldRect.top\n      };\n    }\n  }\n\n  // Get passer position for metadata\n  const passer = getPlayer(fromId);\n  const passerEl = getPlayerEl(fromId);\n  let startField = null, endField = null;\n\n  if (passer && passerEl) {\n    const passerRect = passerEl.getBoundingClientRect();\n    const fieldRect = document.querySelector('.flab-field').getBoundingClientRect();\n    const startView = {\n      x: passerRect.left + passerRect.width / 2 - fieldRect.left,\n      y: passerRect.top + passerRect.height / 2 - fieldRect.top\n    };\n    startField = viewToField(startView);\n    endField = viewToField(finalPoint);\n  }\n\n  // Store comprehensive metadata\n  const meta = {\n    toId: lockId,\n    startInsetPx: getVarPx('--pass-origin-gap', 1.5) + haloRadiusPx(),\n    endInsetPx: getVarPx('--pass-target-gap', 2) + (lockId ? tokenRadiusPx(getPlayerEl(lockId)) : 0),\n    headInsetPx: 16, // arrowhead clearance\n    startField,\n    endField,\n    createdAt: performance.now()\n  };\n\n  const passId = FLAB.arrowCounter++;\n  FLAB.arrows.push({\n    id: passId,\n    fromId,\n    to: { x: finalPoint.x, y: finalPoint.y },\n    curved,\n    control: control ? { x: control.x, y: control.y } : null,\n    meta\n  });\n\n  // Remember last committed pass for \"Play Last\" functionality\n  FLAB.lastPassId = passId;\n\n  // Clear aim state after commit\n  clearAimTags();\n\n  // Import and call renderArrows\n  import('./render.js').then(({ renderArrows }) => {\n    renderArrows();\n  });\n\n  // Highlight the new pass\n  setTimeout(() => highlightPass(passId), 100);\n\n  // Save state for undo\n  saveUndoState(`Add pass from player ${fromId}`);\n}\n\nexport function renderArrows() {\n  const svgRoot = getArrowSvg();\n  if (!svgRoot) return;\n\n  // Get the arrow-group that has the transforms and clipping\n  const arrowGroup = document.getElementById('arrow-group');\n  if (!arrowGroup) {\n    console.warn('renderArrows: #arrow-group not found');\n    return;\n  }\n\n  // Clear existing arrows (except markers in defs)\n  const existingPasses = arrowGroup.querySelectorAll('.svg-pass');\n  existingPasses.forEach(el => el.remove());\n\n  // Create all arrows\n  const promises = FLAB.arrows.map(arrow => createPass(arrow));\n\n  Promise.all(promises).then(groups => {\n    groups.forEach(group => {\n      if (group) {\n        // Append to arrow-group, not svgRoot, to inherit transforms\n        arrowGroup.appendChild(group);\n        // Finalize head positioning after creation\n        finalizeHead(group, FLAB.passStyle);\n      }\n    });\n\n    // Force update all shaft colors after rendering\n    forceUpdateAllShaftColors();\n  });\n\n  document.getElementById(\"arrow-layer\")?.classList.toggle(\"is-interactive\", FLAB.mode === \"erase\");\n}\n\n// Force update all shaft colors - DIRECT SVG attribute approach\nfunction forceUpdateAllShaftColors() {\n  // Get color from multiple sources in priority order\n  let currentColor = '#ffd166'; // fallback\n\n  // Try CSS variable first\n  const cssVar = getComputedStyle(document.documentElement).getPropertyValue('--pass-color').trim();\n  if (cssVar) {\n    currentColor = cssVar;\n  }\n\n  // Try PASS.color if available\n  if (PASS?.color) {\n    currentColor = PASS.color;\n  }\n\n  const allShafts = document.querySelectorAll('.pass-shaft');\n  console.log(`\uD83D\uDD27 Force updating ${allShafts.length} shaft colors to: ${currentColor} (CSS: ${cssVar}, PASS: ${PASS?.color})`);\n\n  allShafts.forEach((shaft, index) => {\n    console.log(`\uD83D\uDD27 Updating shaft ${index + 1}:`);\n    console.log(`  - Before: stroke=\"${shaft.getAttribute('stroke')}\", style.stroke=\"${shaft.style.stroke}\"`);\n\n    // NUCLEAR OPTION: Use both SVG attribute AND inline style\n    shaft.setAttribute('stroke', currentColor);\n    shaft.style.stroke = currentColor;  // Inline style has highest specificity - nothing can override this\n    shaft.style.color = currentColor;\n    shaft.setAttribute('color', currentColor);\n\n    console.log(`  - After: stroke=\"${shaft.getAttribute('stroke')}\", style.stroke=\"${shaft.style.stroke}\"`);\n\n    // Check computed style after update\n    setTimeout(() => {\n      const computed = getComputedStyle(shaft).stroke;\n      console.log(`  - Computed after 100ms: ${computed}`);\n    }, 100);\n  });\n}\n\n// Pass clearing functions for erase menu\nexport function clearLastPass() {\n  const arr = FLAB.arrows || [];\n  if (arr.length > 0) {\n    arr.pop();\n    console.log('Cleared last pass');\n    // Save state for undo\n    saveUndoState('Delete last pass');\n  }\n}\n\nexport function clearAllPasses() {\n  FLAB.arrows = [];\n  console.log('Cleared all passes');\n  // Save state for undo\n  saveUndoState('Clear all passes');\n}\n\nexport function initPassTool() {\n  const arrowLayer = document.getElementById(\"arrow-layer\");\n  if (!arrowLayer) {\n    console.error('Cannot initialize pass tool: #arrow-layer not found');\n    return;\n  }\n\n  // Create/clear a dedicated preview group\n  if (!FLAB.previewGroup) {\n    FLAB.previewGroup = ensureGroup('pass-preview');\n  } else {\n    // purge previous children\n    while (FLAB.previewGroup.firstChild) FLAB.previewGroup.removeChild(FLAB.previewGroup.firstChild);\n    // reattach in case it got detached\n    FLAB.previewGroup = ensureGroup('pass-preview');\n  }\n\n  // Handle arrow layer clicks for erase mode\n  arrowLayer.addEventListener(\"pointerdown\", evt => {\n    if (FLAB.mode !== \"erase\") return;\n\n    const target = evt.target.closest('.svg-pass');\n    if (!target) return;\n\n    const arrowId = target.getAttribute('data-arrow-id');\n    if (arrowId) {\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      FLAB.arrows = FLAB.arrows.filter(item => item.id !== parseInt(arrowId));\n      renderArrows();\n    }\n  });\n}\n\n// Pass data getters for animation module - SINGLE SOURCE OF TRUTH\nexport function getShaftPathForPass(passId) {\n  // Get the ACTUAL visible shaft path that users see\n  return document.querySelector(`#arrow-group [data-arrow-id=\"${passId}\"] .pass-shaft`) ||\n         document.querySelector(`#arrow-group [data-arrow-id=\"${passId}\"] path`) ||\n         document.querySelector(`#arrow-layer [data-arrow-id=\"${passId}\"] path`);\n}\n\nexport function getPassInsets(pass) {\n  const m = pass.meta || {};\n  return {\n    startInsetPx: m.startInsetPx ?? 18,\n    endInsetPx: (m.endInsetPx ?? 18) + (m.headInsetPx ?? 16)\n  };\n}\n\nexport function highlightPass(passId) {\n  // Remove existing highlights\n  document.querySelectorAll('#arrow-group [data-arrow-id].is-selected')\n    .forEach(el => el.classList.remove('is-selected'));\n\n  // Add highlight to selected pass\n  document.querySelectorAll(`#arrow-group [data-arrow-id=\"${passId}\"]`)\n    .forEach(el => el.classList.add('is-selected'));\n}\n\nexport function getPassPathNode(passId) {\n  return getShaftPathForPass(passId);\n}\n\nexport function getPassMeta(passId) {\n  const arrow = FLAB.arrows.find(a => a.id.toString() === passId.toString());\n  if (!arrow) return null;\n\n  return {\n    id: arrow.id.toString(),\n    fromId: arrow.fromId,\n    toId: arrow.toId || null,\n    curved: arrow.curved || false,\n    style: FLAB.passStyle,\n    width: FLAB.passWidth,\n    color: PASS.color || '#ffd166'\n  };\n}\n\nexport function getLastPassId() {\n  const arrows = FLAB.arrows;\n  return arrows.length > 0 ? arrows[arrows.length - 1].id.toString() : null;\n}\n\nexport function getAllPassIds() {\n  return FLAB.arrows.map(arrow => arrow.id.toString());\n}\n\nexport function clearPassHighlight() {\n  // Remove highlight from all passes\n  const highlighted = document.querySelectorAll('#arrow-group [data-arrow-id].is-selected');\n  highlighted.forEach(el => el.classList.remove('is-selected'));\n}\n\n// Head diagnostics for debugging\nexport function logHeadDiagnostics(){\n  const rows = [...document.querySelectorAll('#arrow-layer path.pass-shaft')].map(p=>{\n    const L = p.getTotalLength();\n    const hb = Number(p.dataset.headBaseLen ?? L);\n    const head = p.parentNode.querySelector('.pass-head');\n    const t = head?.getAttribute('transform') || '';\n    const sw = parseFloat(getComputedStyle(p).strokeWidth);\n    return {\n      L: +L.toFixed(1),\n      headBase: +hb.toFixed(1),\n      gap: +(L - hb).toFixed(2),\n      sw,\n      transform: t.slice(0,80)\n    };\n  });\n  console.table(rows);\n}\n\n// Force refresh all existing arrows with current color\nexport function forceArrowRefresh() {\n  const currentColor = PASS?.color || getComputedStyle(document.documentElement).getPropertyValue('--pass-color').trim() || '#ffd166';\n\n  // Force CSS variable update\n  document.documentElement.style.setProperty('--pass-color', currentColor);\n\n  import('../assets/arrows/simple-markers.js')\n    .then(({ updateMarkerColors }) => updateMarkerColors?.(currentColor))\n    .catch(error => console.warn('updateMarkerColors import failed', error));\n\n  // Force recalculation on all existing shaft elements\n  const allShafts = document.querySelectorAll('.pass-shaft');\n  allShafts.forEach(shaft => {\n    shaft.setAttribute('stroke', currentColor);\n    shaft.style.stroke = currentColor;\n    shaft.style.color = currentColor;\n    shaft.setAttribute('color', currentColor);\n    // Force immediate style recalculation\n    getComputedStyle(shaft).stroke;\n  });\n\n  console.log(`\uD83C\uDFA8 Forced refresh of ${allShafts.length} arrow shafts with color: ${currentColor}`);\n}\n\n// Re-export the marker rebuilding function\nexport { rebuildAllMarkers };\n\nwindow.__mod_pass = true;\n\n"],
  "mappings": "+EACA,OAAS,QAAAA,EAAM,OAAAC,EAAe,YAAAC,EAAiB,QAAAC,MAAY,aAC3D,OAAS,gBAAAC,OAAsC,qBAC/C,OAAS,iBAAAC,EAAe,aAAAC,GAAW,qBAAAC,GAA2B,cAAAC,EAAY,cAAAC,EAAY,eAAAC,MAAmB,gBACzG,OAAS,YAAAC,EAAU,gBAAAC,MAAoB,cACvC,OAAS,oBAAAC,EAAkB,qBAAAC,OAAyB,oBACpD,OAAS,aAAAC,GAAW,cAAAC,OAAkB,qBACtC,OAAS,eAAAC,EAAa,eAAAC,MAAmB,eACzC,OAAS,WAAAC,OAAe,cACxB,OAAS,iBAAAC,MAAqB,iBAG9B,SAASC,EAASC,EAASC,EAAW,EAAG,CACvC,MAAMC,EAAM,iBAAiB,SAAS,eAAe,EAAE,iBAAiBF,CAAO,EAC/E,OAAO,WAAWE,CAAG,GAAKD,CAC5B,CAHSE,EAAAJ,EAAA,YAKT,MAAMK,EAAS,6BACTC,GAAc,CAAC,QAAS,aAAc,gBAAgB,EAG5D,SAASC,EAAWC,EAAGC,EAAI,EAAG,CAC5B,GAAI,OAAOD,GAAM,UAAY,OAAO,SAASA,CAAC,EAAG,OAAOA,EACxD,GAAI,OAAOA,GAAM,SAAU,CACzB,MAAME,EAAI,WAAWF,CAAC,EACtB,OAAO,OAAO,SAASE,CAAC,EAAIA,EAAID,CAClC,CACA,OAAOA,CACT,CAPSL,EAAAG,EAAA,cAUT,SAASI,GAAeC,EAAM,CAAE,OAAO/B,EAAS+B,CAAK,EAAE,SAAW,CAAG,CAA5DR,EAAAO,GAAA,kBAUT,eAAsBE,EAAeC,EAAWF,EAAO,CACrD,GAAI,CAACE,EAAW,OAEhB,MAAMC,EAAID,EAAU,eAAe,EAC7BE,EAAWjC,KAAe6B,CAAK,GAAK,EAGpCK,EAAU,KAAK,IAAI,EAAGF,EAAIC,CAAO,EACvCF,EAAU,QAAQ,YAAc,OAAOG,CAAO,EAG9C,KAAM,CAAE,WAAAC,CAAW,EAAI,KAAM,QAAO,oCAAoC,EAExE,GAAI,CAEF,MAAMC,EAAS,MAAMD,EAAWJ,EAAW,QAAQF,CAAK,EAAE,EACtDO,aAAkB,SACpB,MAAMA,EAER,QAAQ,IAAI,kCAA2BP,CAAK,aAAaK,EAAQ,QAAQ,CAAC,CAAC,IAAI,CACjF,OAASG,EAAO,CAEd,GAAI,CACEN,EAAU,eACZA,EAAU,aAAa,aAAc,aAAaF,CAAK,GAAG,EAC1DE,EAAU,aAAa,gBAAiB,oBAAoB,EAC5D,QAAQ,IAAI,oDAA6CF,CAAK,EAAE,EAEpE,MAAwB,CAEtB,QAAQ,MAAM,2CAAsCQ,EAAM,OAAO,EAAE,CACrE,CACF,CACF,CAjCsBhB,EAAAS,EAAA,kBAwCtB,SAASQ,EAAiBT,EAAO,CAC/B,MAAMU,EAAM,SAAS,eAAe,aAAa,EAC7C,CAACA,GAEUA,EAAI,cAAc,SAASV,CAAK,EAAE,GAIjD,OAAO,oBAAoB,EAAE,KAAK,CAAC,CAAE,kBAAAW,CAAkB,IAAM,CAC3DA,EAAkB,CACpB,CAAC,CACH,CAXSnB,EAAAiB,EAAA,oBAkBT,SAASG,EAAaC,EAAWb,EAAQjC,EAAK,UAAW,CACvD,GAAI,CAAC8C,EAAW,OAEhB,MAAMC,EAAQD,EAAU,cAAc,aAAa,EACnD,GAAI,CAACC,EAAO,OAGZ,MAAMC,EAAUF,EAAU,cAAc,YAAY,EAChDE,GACFA,EAAQ,OAAO,EAIjBN,EAAiBT,CAAK,EACtBC,EAAea,EAAOd,CAAK,CAC7B,CAfSR,EAAAoB,EAAA,gBAkBT,SAASI,GAAKC,EAAIC,EAAIC,EAAIC,EAAI,CAC5B,MAAMC,EAAKF,EAAKF,EAAIK,EAAKF,EAAKF,EACxBK,EAAI,KAAK,MAAMF,EAAIC,CAAE,GAAK,EAChC,MAAO,CAAE,GAAID,EAAKE,EAAG,GAAID,EAAKC,EAAG,EAAAA,CAAE,CACrC,CAJS/B,EAAAwB,GAAA,QAOT,SAASQ,EAAUC,EAAU,CAC3B,OAAO1D,EAAK,QAAQ,KAAK2D,GAAUA,EAAO,KAAOD,CAAQ,GAAK,IAChE,CAFSjC,EAAAgC,EAAA,aAIT,SAASG,EAAYF,EAAU,CAC7B,OAAO,SAAS,cAAc,oBAAoBA,CAAQ,IAAI,CAChE,CAFSjC,EAAAmC,EAAA,eAIT,SAASC,EAASC,EAAG,CACnB,OAAAA,EAAE,EAAI,KAAK,MAAMA,EAAE,CAAC,EAAI,GACxBA,EAAE,EAAI,KAAK,MAAMA,EAAE,CAAC,EAAI,GACjBA,CACT,CAJSrC,EAAAoC,EAAA,YAMT,SAASE,GAAe,CAEtB,OADU,SAAS,eAAe,UAAU,GAChC,aAAgB,IAAM,CACpC,CAHStC,EAAAsC,EAAA,gBAKT,SAASC,EAAcC,EAAI,CAEzB,MAAMC,EAAID,GAAI,sBAAsB,EACpC,OAAO,KAAK,IAAI,GAAI,KAAK,IAAIC,GAAG,OAAS,GAAIA,GAAG,QAAU,EAAE,EAAI,CAAC,CACnE,CAJSzC,EAAAuC,EAAA,iBAOT,SAASG,EAAoBR,EAAQ,CACnC,MAAMM,EAAK,SAAS,cAAc,oBAAoBN,EAAO,EAAE,IAAI,EACnE,GAAI,CAACM,EAAI,OAAO,KAEhB,MAAMG,EAAOH,EAAG,sBAAsB,EAChCI,EAAY,SAAS,eAAe,YAAY,EAAE,sBAAsB,EAC9E,MAAO,CACL,EAAGD,EAAK,KAAOA,EAAK,MAAQ,EAAIC,EAAU,KAC1C,EAAGD,EAAK,IAAMA,EAAK,OAAS,EAAIC,EAAU,GAC5C,CACF,CAVS5C,EAAA0C,EAAA,uBAaT,SAASG,GAAkBC,EAAGC,EAAGC,EAAW,CAC1C,IAAIC,EAAO,KAAMC,EAAW,IAC5B,UAAWb,KAAK9D,EAAK,QAAS,CAC5B,GAAI8D,EAAE,KAAOW,EAAW,SACxB,MAAMG,EAAQT,EAAoBL,CAAC,EACnC,GAAI,CAACc,EAAO,SACZ,MAAMpB,EAAI,KAAK,MAAMoB,EAAM,EAAIL,EAAGK,EAAM,EAAIJ,CAAC,EACzChB,EAAImB,IACND,EAAOZ,EACPa,EAAWnB,EAEf,CACA,MAAO,CAAE,OAAQkB,EAAM,KAAMC,CAAS,CACxC,CAbSlD,EAAA6C,GAAA,qBAeF,SAASO,GAAqBC,EAAUC,EAAU,CACvD,MAAMC,EAAW,WAAW,iBAAiB,SAAS,eAAe,EAAE,iBAAiB,mBAAmB,CAAC,GAAK,IAC3GC,EAAS,WAAW,iBAAiB,SAAS,eAAe,EAAE,iBAAiB,mBAAmB,CAAC,GAAK,EAGzGC,EAAK7E,EAAcyE,CAAQ,EAC3BK,EAAK9E,EAAc0E,CAAQ,EAE3BK,EAAarB,EAAa,EAAIiB,EAC9BK,EAAWrB,EAAce,CAAQ,EAAIE,EAE3C,IAAIK,EAAI9E,EAAW0E,EAAG,EAAGA,EAAG,EAAGC,EAAG,EAAGA,EAAG,EAAGC,CAAU,EACjDG,EAAI9E,EAAWyE,EAAG,EAAGA,EAAG,EAAGC,EAAG,EAAGA,EAAG,EAAGE,CAAQ,EAGnD,KAAM,CAAE,EAAA7B,EAAG,GAAAgC,EAAI,GAAAC,CAAG,EAAIxC,GAAKqC,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,CAAC,EACvCG,EAAS,GACf,GAAIlC,EAAIkC,EAAQ,CACd,MAAMC,GAAML,EAAE,EAAIC,EAAE,GAAK,EAAGK,GAAMN,EAAE,EAAIC,EAAE,GAAK,EAAGM,EAAOH,EAAS,EAClEJ,EAAI,CAAE,EAAGK,EAAKH,EAAKK,EAAM,EAAGD,EAAKH,EAAKI,CAAK,EAC3CN,EAAI,CAAE,EAAGI,EAAKH,EAAKK,EAAM,EAAGD,EAAKH,EAAKI,CAAK,CAC7C,CAEA,MAAO,CAAE,EAAGhC,EAASyB,CAAC,EAAG,EAAGzB,EAAS0B,CAAC,CAAE,CAC1C,CAxBgB9D,EAAAoD,GAAA,wBA2BT,SAASiB,GAAmBR,EAAGC,EAAG,CACvC,KAAM,CAAE,EAAAQ,EAAG,EAAAC,CAAE,EAAI1F,GAAU,EACrB2F,EAAM1F,GAAkB+E,EAAE,EAAGA,EAAE,EAAGC,EAAE,EAAGA,EAAE,EAAGQ,EAAGC,CAAC,EACtD,OAAKC,EAAI,QACF,CAAE,EAAGpC,EAAS,CAAC,EAAGoC,EAAI,GAAI,EAAGA,EAAI,EAAE,CAAC,EAAG,EAAGpC,EAAS,CAAC,EAAGoC,EAAI,GAAI,EAAGA,EAAI,EAAE,CAAC,CAAE,EADzD,IAE3B,CALgBxE,EAAAqE,GAAA,sBAOhB,SAASI,GAAejC,EAAIkC,EAAW,KAAM,CAC3C,MAAMC,EAAIpG,EAAK,UACTqG,EAAMD,EAAE,WAAW,OAAO,EAAI,aAAe,aAInD,GAHAnC,EAAG,aAAa,QAASoC,CAAG,EAGxBF,IAAa,KAAM,CAErB,MAAMG,EADa,SAAS,eAAe,aAAa,GAC/B,cAAc,MAAM,EAC7C,GAAIA,EAAM,CACR,MAAMC,EAAW1F,EAAiByF,EAAMF,EAAGD,CAAQ,EACnD,GAAII,EAAU,CACZtC,EAAG,aAAa,aAAc,QAAQsC,CAAQ,GAAG,EACjD,MACF,CACF,CACF,CAGA,MAAMA,EAAWH,IAAM,QAAU,iBAAmBA,IAAM,aAAe,sBAAwB,0BACjGnC,EAAG,aAAa,aAAc,QAAQsC,CAAQ,GAAG,CACnD,CArBS9E,EAAAyE,GAAA,kBAwBT,SAASM,EAAcC,EAAUnB,EAAGoB,EAAMC,EAAUC,EAAOC,EAAY,CACrE,GAAI,CAACJ,EAAU,OACf,QAAQ,MAAM,gBAAiBnB,EAAGoB,EAAMD,GAAU,iBAAiB,EAAE,EAerE,MAAMK,EAAU7F,EAAY,EACtB8F,EAAa,SAAS,eAAe,aAAa,EACxD,GAAI,CAACD,GAAW,CAACC,EAAY,CAC3B,QAAQ,KAAK,iDAAiD,EAC9D,MACF,EAGI,CAACN,GAAYA,EAAS,aAAeM,KAClCN,IACHA,EAAW,SAAS,gBAAgBK,EAAQ,aAAa,GAAG,GAE9DC,EAAW,YAAYN,CAAQ,GAGjC,MAAMH,EAAOQ,EAAQ,cAAc,MAAM,EACnCE,EAASnG,EAAiByF,EAAMK,EAAUC,CAAK,EAC/CK,EAASlG,GAAU6F,EAAO,QAAQ,KAAKD,CAAQ,CAAC,EAChDO,EAAOlG,GAAWiG,CAAM,EAGxB3D,EAAKoD,EAAK,EAAIpB,EAAE,EAChB/B,EAAKmD,EAAK,EAAIpB,EAAE,EAChBlD,EAAI,KAAK,MAAMkB,EAAIC,CAAE,GAAK,EAC1B4D,EAAS,CACb,EAAGT,EAAK,EAAIpD,GAAM4D,EAAO9E,GACzB,EAAGsE,EAAK,EAAInD,GAAM2D,EAAO9E,EAC3B,EAGA,MAAM,KAAKqE,EAAS,QAAQ,EAAE,QAAQW,GAAS,CACxCA,EAAM,UAAU,SAAS,OAAO,GACnCX,EAAS,YAAYW,CAAK,CAE9B,CAAC,EAGD,MAAMC,EAAY,SAAS,gBAAgB3F,EAAQ,MAAM,EACzD2F,EAAU,UAAU,IAAI,YAAY,EACpCA,EAAU,UAAU,IAAIR,CAAU,EAClCQ,EAAU,UAAU,IAAI,QAAQV,CAAQ,EAAE,EAC1CU,EAAU,QAAQ,UAAYV,EAC9BU,EAAU,aAAa,gBAAiB,oBAAoB,EAC5DA,EAAU,aAAa,OAAQ,MAAM,EACrCA,EAAU,aAAa,IAAK,KAAK/B,EAAE,CAAC,IAAIA,EAAE,CAAC,MAAM6B,EAAO,CAAC,IAAIA,EAAO,CAAC,EAAE,EAGvE,IAAIG,EAAe,UAGnB,MAAMC,EAAS,iBAAiB,SAAS,eAAe,EAAE,iBAAiB,cAAc,EAAE,KAAK,EAC5FA,IACFD,EAAeC,GAIbpH,GAAM,QACRmH,EAAenH,EAAK,OAItB,SAAS,gBAAgB,MAAM,YAAY,eAAgBmH,CAAY,EAGnEnH,IACFA,EAAK,MAAQmH,GAGfD,EAAU,aAAa,SAAUC,CAAY,EAC7CD,EAAU,MAAM,OAASC,EACzBD,EAAU,MAAM,MAAQC,EACxBD,EAAU,aAAa,QAASC,CAAY,EAG5Cb,EAAS,YAAYY,CAAS,EAI9B,iBAAiBA,CAAS,EAAE,OAGxBR,IAAe,cACjBQ,EAAU,gBAAgB,kBAAkB,EAI9C,IAAIG,EAAe,EACnB,MAAMC,EAAiBhG,EAAA,IAAM,CAC3B+F,IACA,MAAME,EAAeL,EAAU,aAAa,QAAQ,EAC9CM,EAAiB,iBAAiBN,CAAS,EAAE,OAC7CO,EAAiBP,EAAU,MAAM,OACvC,QAAQ,IAAI,gCAAyBG,CAAY,IAAI,EACrD,QAAQ,IAAI,uBAAuBF,CAAY,EAAE,EACjD,QAAQ,IAAI,6BAA6BI,CAAY,EAAE,EACvD,QAAQ,IAAI,8BAA8BC,CAAc,EAAE,EAC1D,QAAQ,IAAI,4BAA4BC,CAAc,EAAE,EAEpDJ,EAAe,GACjB,WAAWC,EAAgB,GAAG,EAG5BD,IAAiB,GACnB,QAAQ,IAAI,eAAgBH,CAAS,CAEzC,EAlBuB,kBAoBvB,WAAWI,EAAgB,GAAG,EAG9B,MAAMI,EAAW,IAAI,iBAAkBC,GAAc,CACnDA,EAAU,QAASC,GAAa,CAC1BA,EAAS,OAAS,eAAiBA,EAAS,gBAAkB,UAAYA,EAAS,gBAAkB,WACvG,QAAQ,IAAI,4CAAqC,EACjD,QAAQ,IAAI,0BAA0BA,EAAS,aAAa,EAAE,EAC9D,QAAQ,IAAI,kBAAkBV,EAAU,aAAaU,EAAS,aAAa,CAAC,EAAE,EAC9E,QAAQ,IAAI,gCAAgC,iBAAiBV,CAAS,EAAE,MAAM,EAAE,EAEpF,CAAC,CACH,CAAC,EAEDQ,EAAS,QAAQR,EAAW,CAC1B,WAAY,GACZ,gBAAiB,CAAC,SAAU,OAAO,CACrC,CAAC,EAGD,WAAW,IAAMQ,EAAS,WAAW,EAAG,GAAI,EAE5C,QAAQ,IAAI,2CAAsCP,CAAY,UAAUC,CAAM,WAAWpH,GAAM,KAAK,aAAa0G,CAAU,EAAE,EAG7HnE,EAAiBiE,CAAQ,EACzBzE,EAAemF,EAAWV,CAAQ,EAGlCU,EAAU,MAAM,iBAAmB,GACnCA,EAAU,MAAM,cAAgB,MAClC,CA3JS5F,EAAA+E,EAAA,iBA8JT,SAASwB,GAAW,CAAE,GAAAC,EAAI,OAAAC,EAAQ,GAAAC,EAAI,OAAAC,EAAS,GAAO,QAAAC,EAAU,IAAK,EAAG,CAEtE,GAAI,CADgB5E,EAAUyE,CAAM,EAClB,OAAO,KAGzB,MAAMpD,EAAW,SAAS,cAAc,oBAAoBoD,CAAM,IAAI,EACtE,GAAI,CAACpD,EAAU,OAAO,KAGtB,MAAMwD,EAAa,SAAS,cAAc,KAAK,EAC/CA,EAAW,MAAM,QAAU,0BAA0BH,EAAG,CAAC,UAAUA,EAAG,CAAC,iDACvE,SAAS,cAAc,aAAa,EAAE,YAAYG,CAAU,EAE5D,GAAI,CAEF,KAAM,CAAE,EAAAhD,EAAG,EAAAC,CAAE,EAAIV,GAAqBC,EAAUwD,CAAU,EAE1D,IAAIC,EACJ,GAAIH,GAAUC,EAAS,CAErB,MAAMG,EAAe5G,EAAWyG,EAAQ,GAAI/C,EAAE,EAAIC,EAAE,GAAK,CAAC,EACpDkD,EAAe7G,EAAWyG,EAAQ,GAAI/C,EAAE,EAAIC,EAAE,GAAK,CAAC,EAC1DgD,EAAW,KAAKjD,EAAE,CAAC,IAAIA,EAAE,CAAC,MAAMkD,CAAY,IAAIC,CAAY,IAAIlD,EAAE,CAAC,IAAIA,EAAE,CAAC,EAC5E,KAAO,CAEL,MAAMmD,EAAU5C,GAAmBR,EAAGC,CAAC,EACnCmD,EACFH,EAAW,KAAKG,EAAQ,EAAE,CAAC,IAAIA,EAAQ,EAAE,CAAC,MAAMA,EAAQ,EAAE,CAAC,IAAIA,EAAQ,EAAE,CAAC,GAE1EH,EAAW,EAEf,CAGA,GAAKA,EAAS,MAAM,wBAAwB,EAsB1C,eAAQ,KAAK,0CAA2CA,CAAQ,EACzD,KAvBsC,CAG7C,MAAMpC,EAAW,KAAK,MAAMZ,EAAE,EAAID,EAAE,EAAGC,EAAE,EAAID,EAAE,CAAC,EAC1CqB,EAAW3G,EAAK,UAChB6G,EAAaF,EAAS,WAAW,OAAO,EAAI,aAAe,aAE3DgC,EAAQ,SAAS,gBAAgBjH,EAAQ,GAAG,EAClDiH,EAAM,aAAa,gBAAiB,OAAOV,CAAE,CAAC,EAC9CU,EAAM,UAAU,IAAI,UAAU,EAG9BnC,EAAcmC,EAAOrD,EAAGC,EAAGoB,EAAUR,EAAUU,CAAU,EAGzD,MAAM+B,EAAS,SAAS,gBAAgBlH,EAAQ,MAAM,EACtD,OAAAkH,EAAO,aAAa,IAAKL,CAAQ,EACjCK,EAAO,UAAU,IAAI,mBAAmB,EACxCD,EAAM,YAAYC,CAAM,EAEjBD,CACT,CAIF,QAAE,CAEAL,EAAW,OAAO,CACpB,CACF,CA/DS7G,EAAAuG,GAAA,cAkEF,SAASa,GAAiBC,EAAQ,CAQvC,IAPA9I,EAAK,QAAU,CAAE,QAAS,GAAM,OAAQ,GAAO,OAAQmE,EAAoB2E,CAAM,CAAE,EACnF9I,EAAK,aAAe8I,EACpB9I,EAAK,IAAI,YAAc,KACvBA,EAAK,IAAI,SAAW,KACpBA,EAAK,IAAI,OAAS,EAClBY,EAAa,EACbZ,EAAK,SAAWkB,EAAY,cAAc,EACnClB,EAAK,SAAS,YAAYA,EAAK,SAAS,YAAYA,EAAK,SAAS,UAAU,CACrF,CATgByB,EAAAoH,GAAA,oBAYhB,SAASE,GAAc9G,EAAO,CAC5B,OAAOA,EAAM,WAAW,OAAO,EAAI,aAAe,YACpD,CAFSR,EAAAsH,GAAA,iBAKF,SAASC,IAAa,CAC3B,GAAI,CAAChJ,EAAK,SAAS,QAAS,OAC5B,MAAM8I,EAAS9I,EAAK,aACpB,GAAI,CAAC8I,EAAQ,OAEb,MAAMG,EAAMjJ,EAAK,QAAQ,OACnBkJ,EAAS7H,EAAS,oBAAqB,CAAC,EACxC8H,EAAahF,EAAoB2E,CAAM,EAE7C,IAAIM,EAAOH,EACX,GAAIjJ,EAAK,IAAI,SAAU,CACrB,MAAMqJ,EAAI5F,EAAUzD,EAAK,IAAI,QAAQ,EAC/BsJ,EAAQnF,EAAoBkF,CAAC,EAC/BF,GAAcG,IAEhBF,EAAO3I,EAAW0I,EAAW,EAAGA,EAAW,EAAGG,EAAM,EAAGA,EAAM,EAAG,GAAUJ,CAAM,EAEpF,CAEAK,GAAYT,EAAO,GAAIM,EAAMpJ,EAAK,QAAQ,OAAQA,EAAK,QAAQ,OAAO,EAGtE,MAAMwJ,EAAa9I,EAAYyI,CAAU,EACnCM,EAAW/I,EAAY0I,CAAI,EAE3BnH,EAAQjC,EAAK,UACb0J,EAAQ1J,EAAK,UACb2J,EAAQxJ,EAAK,OAAS,UACtBiI,EAAS,CAAC,CAACpI,EAAK,SAAS,OAEzBkI,EAASY,EAAO,GAChBc,EAAUd,EAAO,QAAUA,EAAO,GAGlCe,EAAW7J,EAAK,KAAK,UAAY,KACjC8J,EAASD,EAAWpG,EAAUoG,CAAQ,EAAI,KAC1CE,EAAOD,GAAQ,IAAM,KACrBE,EAAQF,GAAQ,QAAUA,GAAQ,IAAM,KAExCxG,EAAK8F,EAAK,EAAID,EAAW,EACzB5F,EAAK6F,EAAK,EAAID,EAAW,EACzBhD,EAAW,KAAK,MAAM7C,EAAIC,CAAE,EAalC,IAXApC,GAAQ,CACN,OAAA+G,EAAQ,KAAA6B,EAAM,QAAAH,EAAS,MAAAI,EACvB,MAAA/H,EAAO,MAAAyH,EAAO,MAAAC,EAAO,OAAAvB,EAAQ,SAAAjC,EAC7B,WAAAqD,EAAY,SAAAC,CACd,CAAC,EAEDzJ,EAAK,QAAU,KAGfA,EAAK,IAAI,YAAcA,EAAK,IAAI,SAAW,KAC3CY,EAAa,EACNZ,EAAK,UAAU,YAAYA,EAAK,SAAS,YAAYA,EAAK,SAAS,UAAU,CACtF,CAvDgByB,EAAAuH,GAAA,cAyDT,SAASiB,GAAkBpI,EAAG,CACnC,GAAI,CAAC7B,EAAK,SAAS,QAAS,OAC5B,MAAM8I,EAAS9I,EAAK,aAIpB,GAHI,CAAC8I,GAGD,CAACjH,GAAK,OAAOA,EAAE,GAAM,UAAY,OAAOA,EAAE,GAAM,SAClD,OAGF,QAAQ,MAAM,cAAeA,EAAE,EAAE,EAAGA,EAAE,EAAE,CAAC,EAGzC7B,EAAK,QAAQ,OAAS6B,EAGtB,IAAIqI,EAAO,KACX,GAAIjK,EAAI,QAAS,CACf,KAAM,CAAE,OAAA0D,EAAQ,KAAAwG,CAAK,EAAI7F,GAAkBzC,EAAE,EAAGA,EAAE,EAAGiH,EAAO,EAAE,EAC1DnF,GAAUwG,GAAQlK,EAAI,SAAQiK,EAAOvG,EAC3C,CAEA,MAAMyG,EAAM,YAAY,IAAI,EAG5B,GAAIF,EACF,GAAIlK,EAAK,IAAI,SAAU,CACrB,MAAMqK,EAAK5G,EAAUzD,EAAK,IAAI,QAAQ,EAChCsK,EAASnG,EAAoBkG,CAAE,EACjCC,GACQ,KAAK,MAAMA,EAAO,EAAIzI,EAAE,EAAGyI,EAAO,EAAIzI,EAAE,CAAC,EAC3C5B,EAAI,OAASA,EAAI,aACvBD,EAAK,IAAI,SAAW,KACpBA,EAAK,IAAI,YAAckK,EAAK,GAC5BlK,EAAK,IAAI,OAASoK,EAGxB,MACMpK,EAAK,IAAI,cAAgBkK,EAAK,IAChClK,EAAK,IAAI,YAAckK,EAAK,GAC5BlK,EAAK,IAAI,OAASoK,GACTA,EAAMpK,EAAK,IAAI,QAAUC,EAAI,QACtCD,EAAK,IAAI,SAAWkK,EAAK,SAI7BlK,EAAK,IAAI,YAAc,KACvBA,EAAK,IAAI,SAAW,KAItBY,EAAa,EACTZ,EAAK,IAAI,aAAe,CAACA,EAAK,IAAI,UACpCW,EAASX,EAAK,IAAI,WAAW,GAAG,aAAa,WAAY,KAAK,EAE5DA,EAAK,IAAI,UACXW,EAASX,EAAK,IAAI,QAAQ,GAAG,aAAa,WAAY,MAAM,EAI9D,MAAMuK,GAAS,SAAS,eAAe,UAAU,GAAG,aAAe,GAAK,EAClEvF,EAAW3D,EAAS,oBAAqB,GAAG,EAC5C8H,EAAahF,EAAoB2E,CAAM,EAC7C,GAAI,CAACK,EAAY,OACjB,MAAMqB,EAAQhK,EAAW2I,EAAW,EAAGA,EAAW,EAAGtH,EAAE,EAAGA,EAAE,EAAG0I,EAAQvF,CAAQ,EAE/E,IAAIyF,EAAO5I,EAAE,EAAG6I,EAAO7I,EAAE,EACzB,MAAMqH,EAAS7H,EAAS,oBAAqB,CAAC,EACxCsJ,EAAU,GAEhB,GAAI3K,EAAK,IAAI,SAAU,CACrB,MAAMqJ,EAAI5F,EAAUzD,EAAK,IAAI,QAAQ,EAC/BsJ,EAAQnF,EAAoBkF,CAAC,EACnC,GAAIC,EAAO,CACT,MAAMsB,EAAatB,EAAM,EAAIH,EAAW,EAClC0B,EAAavB,EAAM,EAAIH,EAAW,EAClC2B,EAAcF,GAAc,EAAIC,GAAc,EACpD,GAAIC,EAAc,EAAG,CACnB,MAAMC,EAAclJ,EAAE,EAAIsH,EAAW,EAC/B6B,EAAcnJ,EAAE,EAAIsH,EAAW,EAErC,IADoB4B,EAAcH,EAAaI,EAAcH,GAAcC,EAC1D,KACf9K,EAAK,IAAI,SAAW,KACpBA,EAAK,IAAI,YAAc,SAClB,CACL,MAAMiL,EAAMxK,EAAW0I,EAAW,EAAGA,EAAW,EAAGG,EAAM,EAAGA,EAAM,EAAGqB,EAAUzB,CAAM,EACrFuB,EAAOQ,EAAI,EACXP,EAAOO,EAAI,CACb,CACF,CACF,CACF,CAGA,MAAMC,EAAM,KAAK,MAAMT,EAAOD,EAAM,EAAGE,EAAOF,EAAM,CAAC,EACrDhE,EAAcxG,EAAK,SAAUwK,EAAO,CAAE,EAAGC,EAAM,EAAGC,CAAK,EAAG1K,EAAK,UAAWkL,EAAKnC,GAAc/I,EAAK,SAAS,CAAC,EAG5G6C,EAAa7C,EAAK,SAAUA,EAAK,SAAS,CAC5C,CAnGgByB,EAAAwI,GAAA,qBAsGT,SAASV,GAAYrB,EAAQiD,EAAO/C,EAAS,GAAOC,EAAU,KAAM,CACzE,GAAI,CAAC8C,EAAO,OAGZ,MAAMC,EAASpL,EAAK,KAAK,UAAY,KAGrC,IAAIqL,EAAaF,EACjB,MAAMG,EAASF,EAAS3H,EAAU2H,CAAM,EAAI,KAC5C,GAAIE,EAAQ,CACV,MAAMC,EAAW3H,EAAY0H,EAAO,EAAE,EACtC,GAAIC,EAAU,CACZ,MAAMnH,EAAOmH,EAAS,sBAAsB,EACtClH,EAAY,SAAS,cAAc,aAAa,EAAE,sBAAsB,EAC9EgH,EAAa,CACX,EAAGjH,EAAK,KAAOA,EAAK,MAAQ,EAAIC,EAAU,KAC1C,EAAGD,EAAK,IAAMA,EAAK,OAAS,EAAIC,EAAU,GAC5C,CACF,CACF,CAGA,MAAMyE,EAASrF,EAAUyE,CAAM,EACzBpD,EAAWlB,EAAYsE,CAAM,EACnC,IAAIsB,EAAa,KAAMC,EAAW,KAElC,GAAIX,GAAUhE,EAAU,CACtB,MAAM0G,EAAa1G,EAAS,sBAAsB,EAC5CT,EAAY,SAAS,cAAc,aAAa,EAAE,sBAAsB,EACxEoH,EAAY,CAChB,EAAGD,EAAW,KAAOA,EAAW,MAAQ,EAAInH,EAAU,KACtD,EAAGmH,EAAW,IAAMA,EAAW,OAAS,EAAInH,EAAU,GACxD,EACAmF,EAAa9I,EAAY+K,CAAS,EAClChC,EAAW/I,EAAY2K,CAAU,CACnC,CAGA,MAAMK,EAAO,CACX,KAAMN,EACN,aAAc/J,EAAS,oBAAqB,GAAG,EAAI0C,EAAa,EAChE,WAAY1C,EAAS,oBAAqB,CAAC,GAAK+J,EAASpH,EAAcJ,EAAYwH,CAAM,CAAC,EAAI,GAC9F,YAAa,GACb,WAAA5B,EACA,SAAAC,EACA,UAAW,YAAY,IAAI,CAC7B,EAEMkC,EAAS3L,EAAK,eACpBA,EAAK,OAAO,KAAK,CACf,GAAI2L,EACJ,OAAAzD,EACA,GAAI,CAAE,EAAGmD,EAAW,EAAG,EAAGA,EAAW,CAAE,EACvC,OAAAjD,EACA,QAASC,EAAU,CAAE,EAAGA,EAAQ,EAAG,EAAGA,EAAQ,CAAE,EAAI,KACpD,KAAAqD,CACF,CAAC,EAGD1L,EAAK,WAAa2L,EAGlB/K,EAAa,EAGb,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,aAAAgL,CAAa,IAAM,CAC/CA,EAAa,CACf,CAAC,EAGD,WAAW,IAAMC,GAAcF,CAAM,EAAG,GAAG,EAG3CvK,EAAc,wBAAwB8G,CAAM,EAAE,CAChD,CA1EgBzG,EAAA8H,GAAA,eA4ET,SAASqC,IAAe,CAE7B,GAAI,CADY3K,EAAY,EACd,OAGd,MAAM8F,EAAa,SAAS,eAAe,aAAa,EACxD,GAAI,CAACA,EAAY,CACf,QAAQ,KAAK,sCAAsC,EACnD,MACF,CAGuBA,EAAW,iBAAiB,WAAW,EAC/C,QAAQ9C,GAAMA,EAAG,OAAO,CAAC,EAGxC,MAAM6H,EAAW9L,EAAK,OAAO,IAAI+L,GAAS/D,GAAW+D,CAAK,CAAC,EAE3D,QAAQ,IAAID,CAAQ,EAAE,KAAKE,GAAU,CACnCA,EAAO,QAAQrD,GAAS,CAClBA,IAEF5B,EAAW,YAAY4B,CAAK,EAE5B9F,EAAa8F,EAAO3I,EAAK,SAAS,EAEtC,CAAC,EAGDiM,GAA0B,CAC5B,CAAC,EAED,SAAS,eAAe,aAAa,GAAG,UAAU,OAAO,iBAAkBjM,EAAK,OAAS,OAAO,CAClG,CAjCgByB,EAAAmK,GAAA,gBAoChB,SAASK,IAA4B,CAEnC,IAAI3E,EAAe,UAGnB,MAAMC,EAAS,iBAAiB,SAAS,eAAe,EAAE,iBAAiB,cAAc,EAAE,KAAK,EAC5FA,IACFD,EAAeC,GAIbpH,GAAM,QACRmH,EAAenH,EAAK,OAGtB,MAAM+L,EAAY,SAAS,iBAAiB,aAAa,EACzD,QAAQ,IAAI,4BAAqBA,EAAU,MAAM,qBAAqB5E,CAAY,UAAUC,CAAM,WAAWpH,GAAM,KAAK,GAAG,EAE3H+L,EAAU,QAAQ,CAACnJ,EAAOoJ,IAAU,CAClC,QAAQ,IAAI,4BAAqBA,EAAQ,CAAC,GAAG,EAC7C,QAAQ,IAAI,uBAAuBpJ,EAAM,aAAa,QAAQ,CAAC,oBAAoBA,EAAM,MAAM,MAAM,GAAG,EAGxGA,EAAM,aAAa,SAAUuE,CAAY,EACzCvE,EAAM,MAAM,OAASuE,EACrBvE,EAAM,MAAM,MAAQuE,EACpBvE,EAAM,aAAa,QAASuE,CAAY,EAExC,QAAQ,IAAI,sBAAsBvE,EAAM,aAAa,QAAQ,CAAC,oBAAoBA,EAAM,MAAM,MAAM,GAAG,EAGvG,WAAW,IAAM,CACf,MAAMqJ,EAAW,iBAAiBrJ,CAAK,EAAE,OACzC,QAAQ,IAAI,6BAA6BqJ,CAAQ,EAAE,CACrD,EAAG,GAAG,CACR,CAAC,CACH,CApCS3K,EAAAwK,GAAA,6BAuCF,SAASI,IAAgB,CAC9B,MAAMC,EAAMtM,EAAK,QAAU,CAAC,EACxBsM,EAAI,OAAS,IACfA,EAAI,IAAI,EACR,QAAQ,IAAI,mBAAmB,EAE/BlL,EAAc,kBAAkB,EAEpC,CARgBK,EAAA4K,GAAA,iBAUT,SAASE,IAAiB,CAC/BvM,EAAK,OAAS,CAAC,EACf,QAAQ,IAAI,oBAAoB,EAEhCoB,EAAc,kBAAkB,CAClC,CALgBK,EAAA8K,GAAA,kBAOT,SAASC,IAAe,CAC7B,MAAMC,EAAa,SAAS,eAAe,aAAa,EACxD,GAAI,CAACA,EAAY,CACf,QAAQ,MAAM,qDAAqD,EACnE,MACF,CAGA,GAAI,CAACzM,EAAK,aACRA,EAAK,aAAekB,EAAY,cAAc,MACzC,CAEL,KAAOlB,EAAK,aAAa,YAAYA,EAAK,aAAa,YAAYA,EAAK,aAAa,UAAU,EAE/FA,EAAK,aAAekB,EAAY,cAAc,CAChD,CAGAuL,EAAW,iBAAiB,cAAeC,GAAO,CAChD,GAAI1M,EAAK,OAAS,QAAS,OAE3B,MAAM8J,EAAS4C,EAAI,OAAO,QAAQ,WAAW,EAC7C,GAAI,CAAC5C,EAAQ,OAEb,MAAM6C,EAAU7C,EAAO,aAAa,eAAe,EAC/C6C,IACFD,EAAI,eAAe,EACnBA,EAAI,gBAAgB,EAEpB1M,EAAK,OAASA,EAAK,OAAO,OAAO4M,GAAQA,EAAK,KAAO,SAASD,CAAO,CAAC,EACtEf,GAAa,EAEjB,CAAC,CACH,CAjCgBnK,EAAA+K,GAAA,gBAoCT,SAASK,GAAoBlB,EAAQ,CAE1C,OAAO,SAAS,cAAc,gCAAgCA,CAAM,gBAAgB,GAC7E,SAAS,cAAc,gCAAgCA,CAAM,SAAS,GACtE,SAAS,cAAc,gCAAgCA,CAAM,SAAS,CAC/E,CALgBlK,EAAAoL,GAAA,uBAOT,SAASC,GAAcC,EAAM,CAClC,MAAMC,EAAID,EAAK,MAAQ,CAAC,EACxB,MAAO,CACL,aAAcC,EAAE,cAAgB,GAChC,YAAaA,EAAE,YAAc,KAAOA,EAAE,aAAe,GACvD,CACF,CANgBvL,EAAAqL,GAAA,iBAQT,SAASjB,GAAcF,EAAQ,CAEpC,SAAS,iBAAiB,0CAA0C,EACjE,QAAQ1H,GAAMA,EAAG,UAAU,OAAO,aAAa,CAAC,EAGnD,SAAS,iBAAiB,gCAAgC0H,CAAM,IAAI,EACjE,QAAQ1H,GAAMA,EAAG,UAAU,IAAI,aAAa,CAAC,CAClD,CARgBxC,EAAAoK,GAAA,iBAUT,SAASoB,GAAgBtB,EAAQ,CACtC,OAAOkB,GAAoBlB,CAAM,CACnC,CAFgBlK,EAAAwL,GAAA,mBAIT,SAASC,GAAYvB,EAAQ,CAClC,MAAMI,EAAQ/L,EAAK,OAAO,KAAKmN,GAAKA,EAAE,GAAG,SAAS,IAAMxB,EAAO,SAAS,CAAC,EACzE,OAAKI,EAEE,CACL,GAAIA,EAAM,GAAG,SAAS,EACtB,OAAQA,EAAM,OACd,KAAMA,EAAM,MAAQ,KACpB,OAAQA,EAAM,QAAU,GACxB,MAAO/L,EAAK,UACZ,MAAOA,EAAK,UACZ,MAAOG,EAAK,OAAS,SACvB,EAVmB,IAWrB,CAbgBsB,EAAAyL,GAAA,eAeT,SAASE,IAAgB,CAC9B,MAAMC,EAASrN,EAAK,OACpB,OAAOqN,EAAO,OAAS,EAAIA,EAAOA,EAAO,OAAS,CAAC,EAAE,GAAG,SAAS,EAAI,IACvE,CAHgB5L,EAAA2L,GAAA,iBAKT,SAASE,IAAgB,CAC9B,OAAOtN,EAAK,OAAO,IAAI+L,GAASA,EAAM,GAAG,SAAS,CAAC,CACrD,CAFgBtK,EAAA6L,GAAA,iBAIT,SAASC,IAAqB,CAEf,SAAS,iBAAiB,0CAA0C,EAC5E,QAAQtJ,GAAMA,EAAG,UAAU,OAAO,aAAa,CAAC,CAC9D,CAJgBxC,EAAA8L,GAAA,sBAOT,SAASC,IAAoB,CAClC,MAAMC,EAAO,CAAC,GAAG,SAAS,iBAAiB,8BAA8B,CAAC,EAAE,IAAI3J,GAAG,CACjF,MAAM1B,EAAI0B,EAAE,eAAe,EACrB4J,EAAK,OAAO5J,EAAE,QAAQ,aAAe1B,CAAC,EAEtCiH,EADOvF,EAAE,WAAW,cAAc,YAAY,GACpC,aAAa,WAAW,GAAK,GACvC6J,EAAK,WAAW,iBAAiB7J,CAAC,EAAE,WAAW,EACrD,MAAO,CACL,EAAG,CAAC1B,EAAE,QAAQ,CAAC,EACf,SAAU,CAACsL,EAAG,QAAQ,CAAC,EACvB,IAAK,EAAEtL,EAAIsL,GAAI,QAAQ,CAAC,EACxB,GAAAC,EACA,UAAWtE,EAAE,MAAM,EAAE,EAAE,CACzB,CACF,CAAC,EACD,QAAQ,MAAMoE,CAAI,CACpB,CAhBgBhM,EAAA+L,GAAA,sBAmBT,SAASI,IAAoB,CAClC,MAAMtG,EAAenH,GAAM,OAAS,iBAAiB,SAAS,eAAe,EAAE,iBAAiB,cAAc,EAAE,KAAK,GAAK,UAG1H,SAAS,gBAAgB,MAAM,YAAY,eAAgBmH,CAAY,EAEvE,OAAO,oCAAoC,EACxC,KAAK,CAAC,CAAE,mBAAAuG,CAAmB,IAAMA,IAAqBvG,CAAY,CAAC,EACnE,MAAM7E,GAAS,QAAQ,KAAK,mCAAoCA,CAAK,CAAC,EAGzE,MAAMyJ,EAAY,SAAS,iBAAiB,aAAa,EACzDA,EAAU,QAAQnJ,GAAS,CACzBA,EAAM,aAAa,SAAUuE,CAAY,EACzCvE,EAAM,MAAM,OAASuE,EACrBvE,EAAM,MAAM,MAAQuE,EACpBvE,EAAM,aAAa,QAASuE,CAAY,EAExC,iBAAiBvE,CAAK,EAAE,MAC1B,CAAC,EAED,QAAQ,IAAI,+BAAwBmJ,EAAU,MAAM,6BAA6B5E,CAAY,EAAE,CACjG,CAtBgB7F,EAAAmM,GAAA,qBA2BhB,OAAO,WAAa",
  "names": ["FLAB", "AIM", "headSpec", "PASS", "HEAD_OVERLAP", "centerInField", "fieldSize", "clipSegmentToRect", "insetFromA", "insetFromB", "viewToField", "playerEl", "clearAimTags", "ensureHeadMarker", "rebuildAllMarkers", "headPxFor", "headTrimPx", "getArrowSvg", "ensureGroup", "logPass", "saveUndoState", "getVarPx", "varName", "fallback", "val", "__name", "SVG_NS", "PASS_STYLES", "safeNumber", "v", "def", "n", "headOverlapFor", "style", "attachPassHead", "shaftPath", "L", "overlap", "baseLen", "attachHead", "result", "error", "ensurePassMarker", "svg", "preloadArrowHeads", "finalizeHead", "passGroup", "shaft", "oldHead", "unit", "ax", "ay", "bx", "by", "dx", "dy", "d", "getPlayer", "playerId", "player", "getPlayerEl", "snapHalf", "p", "haloRadiusPx", "tokenRadiusPx", "el", "r", "getPlayerViewCoords", "rect", "fieldRect", "nearestPlayerView", "x", "y", "excludeId", "best", "bestDist", "pView", "computePassEndpoints", "passerEl", "targetEl", "startGap", "endGap", "A0", "B0", "startInset", "endInset", "A", "B", "ux", "uy", "minLen", "cx", "cy", "half", "computeClippedPass", "w", "h", "seg", "applyPassStyle", "lengthPx", "s", "cls", "defs", "markerId", "setArrowPaths", "svgGroup", "Btip", "styleKey", "lenPx", "shaftClass", "svgRoot", "arrowGroup", "headId", "headPx", "trim", "Bshaft", "child", "mainShaft", "currentColor", "cssVar", "monitorCount", "monitorChanges", "actualStroke", "computedStroke", "hasStyleStroke", "observer", "mutations", "mutation", "createPass", "id", "fromId", "to", "curved", "control", "tempTarget", "pathData", "safeControlX", "safeControlY", "clipped", "group", "hitbox", "beginPassPreview", "passer", "shaftClassFor", "commitPass", "cur", "tgtGap", "passerView", "endV", "t", "tView", "commitArrow", "startField", "endField", "width", "color", "fromNum", "lockedId", "target", "toId", "toNum", "updatePassPreview", "cand", "dist", "now", "lp", "lpView", "haloR", "start", "endX", "endY", "targetR", "targetVecX", "targetVecY", "targetLenSq", "pointerVecX", "pointerVecY", "end", "len", "point", "lockId", "finalPoint", "locked", "lockedEl", "passerRect", "startView", "meta", "passId", "renderArrows", "highlightPass", "promises", "arrow", "groups", "forceUpdateAllShaftColors", "allShafts", "index", "computed", "clearLastPass", "arr", "clearAllPasses", "initPassTool", "arrowLayer", "evt", "arrowId", "item", "getShaftPathForPass", "getPassInsets", "pass", "m", "getPassPathNode", "getPassMeta", "a", "getLastPassId", "arrows", "getAllPassIds", "clearPassHighlight", "logHeadDiagnostics", "rows", "hb", "sw", "forceArrowRefresh", "updateMarkerColors"]
}
