{
  "version": 3,
  "sources": ["../../scripts/render.js"],
  "sourcesContent": ["// Render module for Formation Lab\nimport { FLAB } from './state.js';\nimport { n2p_view, p2n_view, clampPx } from './geometry.js';\nimport { playerEls } from './drag.js';\n\n// SVG namespace constants\nconst SVG_NS = 'http://www.w3.org/2000/svg';\n\n// Layer management for ball visibility\nexport function ensureLayer(id) {\n  const svg = document.getElementById('arrow-layer');\n  if (!svg) return null;\n\n  let g = document.getElementById(id);\n  if (!g) {\n    g = document.createElementNS(SVG_NS, 'g');\n    g.id = id;\n    g.setAttribute('pointer-events', 'none');\n    svg.appendChild(g);\n  }\n  return g;\n}\n\nexport function ensureLayerOrder() {\n  const svg = document.getElementById('arrow-layer');\n  if (!svg) {\n    console.warn('ensureLayerOrder: #arrow-layer not found');\n    return;\n  }\n\n  // Get the existing arrow-group that has the transforms and clipping\n  const arrowGroup = document.getElementById('arrow-group');\n  if (!arrowGroup) {\n    console.warn('ensureLayerOrder: #arrow-group not found');\n    return;\n  }\n\n  // Create ball layer INSIDE the arrow-group (same coordinate space)\n  let ballLayer = document.getElementById('ball-layer');\n  if (!ballLayer) {\n    ballLayer = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    ballLayer.id = 'ball-layer';\n    ballLayer.setAttribute('pointer-events', 'none');\n  }\n\n  // Ensure ball layer is the LAST child of arrow-group (paints on top)\n  if (ballLayer.parentNode !== arrowGroup) {\n    arrowGroup.appendChild(ballLayer);\n  }\n\n  // Create debug layer as sibling to arrow-group (outside clipping)\n  let debugLayer = document.getElementById('arrow-debug-layer');\n  if (!debugLayer) {\n    debugLayer = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    debugLayer.id = 'arrow-debug-layer';\n    debugLayer.setAttribute('pointer-events', 'none');\n    svg.appendChild(debugLayer);\n  }\n\n  console.log('\uD83C\uDFA8 Layer order ensured: ball-layer inside arrow-group (same transforms)');\n}\n\n// Utility functions for aim-assist\nexport function playerEl(id) {\n  return document.querySelector(`.player[data-id=\"${id}\"]`);\n}\n\nexport function clearAimTags() {\n  document.querySelectorAll('.player[data-aim]').forEach(n => n.removeAttribute('data-aim'));\n}\n\n// Keep players inside playable area by clamping their canonical coordinates\nfunction clampPlayerCanonical(pl) {\n  // project to current view \u2192 clamp px \u2192 convert back to canonical norm\n  const p = n2p_view(pl.nx, pl.ny);\n  const pc = clampPx(p.x, p.y);\n  if (pc.x !== p.x || pc.y !== p.y) {\n    const n = p2n_view(pc.x, pc.y);\n    pl.nx = Math.min(1, Math.max(0, n.nx));\n    pl.ny = Math.min(1, Math.max(0, n.ny));\n  }\n}\n\n// Place player element using normalized coordinates\nexport function placePlayerEl(el, player) {\n  const { x, y } = n2p_view(player.nx, player.ny);\n  el.style.left = `${x}px`;\n  el.style.top = `${y}px`;\n}\n\n// Re-layout all players after resize/orientation change\nexport function relayoutAllPlayers() {\n  // First clamp all players to ensure they stay inside playable area\n  (FLAB.players || []).forEach(clampPlayerCanonical);\n\n  // Then position the DOM elements\n  for (const p of FLAB.players) {\n    const el = document.querySelector(`.flab-player[data-id=\"${p.id}\"]`);\n    if (el) placePlayerEl(el, p);\n  }\n}\n\n// Ensure halo exists and is properly configured\nexport function ensureHalo() {\n  let halo = document.getElementById('flabHalo');\n  if (!halo) {\n    console.warn('Creating fallback halo element');\n    halo = document.createElement('div');\n    halo.id = 'flabHalo';\n    halo.className = 'flab-halo';\n    halo.style.cssText = 'position:absolute;width:56px;height:56px;pointer-events:none;opacity:0;';\n    halo.setAttribute('aria-hidden', 'true');\n\n    const field = document.getElementById('formationField');\n    if (field) field.appendChild(halo);\n  }\n\n  // Ensure pointer events are disabled\n  halo.style.pointerEvents = 'none';\n  return halo;\n}\n\nexport function updateHalo() {\n  const halo = ensureHalo();\n  if (!FLAB.selectedId) {\n    halo.classList.remove(\"is-visible\");\n    return;\n  }\n  const player = FLAB.players.find(p => p.id === FLAB.selectedId);\n  if (!player) {\n    halo.classList.remove(\"is-visible\");\n    return;\n  }\n  const { x, y } = n2p_view(player.nx, player.ny);\n  halo.style.left = `${x}px`;\n  halo.style.top = `${y}px`;\n  halo.classList.add(\"is-visible\");\n}\n\nexport function renderPlayers() {\n  FLAB.players.forEach(player => {\n    const el = playerEls.get(player.id);\n    if (!el) return;\n    placePlayerEl(el, player);\n  });\n}\n\nexport function renderArrows() {\n  // Import and call renderArrows from pass module\n  import('./pass.js').then(({ renderArrows }) => {\n    renderArrows();\n  });\n}\n\n// Resize handling\nexport function handleResize() {\n  // Re-measure and re-layout everything\n  relayoutAllPlayers();\n  updateHalo();\n  renderArrows();\n}\n\nwindow.__mod_render = true;"],
  "mappings": "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",
  "names": ["FLAB", "n2p_view", "p2n_view", "clampPx", "playerEls", "SVG_NS", "ensureLayer", "id", "svg", "g", "__name", "ensureLayerOrder", "arrowGroup", "ballLayer", "debugLayer", "playerEl", "clearAimTags", "n", "clampPlayerCanonical", "pl", "p", "pc", "placePlayerEl", "el", "player", "x", "y", "relayoutAllPlayers", "ensureHalo", "halo", "field", "updateHalo", "renderPlayers", "renderArrows", "handleResize"]
}
