{
  "version": 3,
  "sources": ["../../scripts/presets.js"],
  "sourcesContent": ["// Formation presets module for Formation Lab\r\nimport { FLAB } from './state.js';\r\nimport { p2n_view } from './geometry.js';\r\nimport { relayoutAllPlayers } from './render.js';\r\n\r\n// Formation presets in normalized canonical coordinates\r\nconst FORMATIONS = {\r\n  '4-3-3': [\r\n    { id: 1, role: \"GK\", nx: 0.1, ny: 0.5 },\r\n    { id: 2, role: \"DF\", nx: 0.25, ny: 0.24 },  // LB nudged inward from 0.2 to 0.24\r\n    { id: 3, role: \"DF\", nx: 0.25, ny: 0.76 },  // RB nudged inward from 0.8 to 0.76\r\n    { id: 4, role: \"DF\", nx: 0.35, ny: 0.35 },\r\n    { id: 5, role: \"DF\", nx: 0.35, ny: 0.65 },\r\n    { id: 6, role: \"MF\", nx: 0.55, ny: 0.3 },\r\n    { id: 7, role: \"MF\", nx: 0.55, ny: 0.7 },\r\n    { id: 8, role: \"MF\", nx: 0.65, ny: 0.5 },\r\n    { id: 9, role: \"FW\", nx: 0.8, ny: 0.35 },\r\n    { id: 10, role: \"FW\", nx: 0.8, ny: 0.65 },\r\n    { id: 11, role: \"FW\", nx: 0.9, ny: 0.5 }\r\n  ]\r\n};\r\n\r\n// Upgrade legacy coordinates helper\r\nfunction upgradeLegacyXY(p) {\r\n  if (p.nx == null || p.ny == null) {\r\n    p.nx = 0.5;\r\n    p.ny = 0.5;\r\n    delete p.x;\r\n    delete p.y;\r\n  }\r\n}\r\n\r\n// Apply a formation preset\r\nexport function applyPreset(name) {\r\n  const formation = FORMATIONS[name];\r\n  if (!formation) {\r\n    console.warn(`Unknown formation preset: ${name}`);\r\n    return;\r\n  }\r\n\r\n  // Reset state\r\n  FLAB.players = formation.map(slot => ({\r\n    id: slot.id,\r\n    role: slot.role,\r\n    nx: slot.nx,\r\n    ny: slot.ny\r\n  }));\r\n\r\n  FLAB.players.forEach(upgradeLegacyXY);\r\n  FLAB.arrows = [];\r\n  FLAB.arrowCounter = 1;\r\n  FLAB.selectedId = null;\r\n  FLAB.drag = null;\r\n  FLAB.passArm = null;\r\n\r\n  // Import and reinitialize drag system\r\n  import('./drag.js').then(({ initDrag }) => {\r\n    initDrag();\r\n  });\r\n\r\n  console.log(`\uD83D\uDCCB Applied formation preset: ${name}`);\r\n}\r\n\r\n// Get available preset names\r\nexport function getPresetNames() {\r\n  return Object.keys(FORMATIONS);\r\n}\r\n\r\n// Canonical snapshot from current view\r\nexport function snapshotCurrentPlayersCanonical() {\r\n  // convert current DOM/view positions back to canonical nx,ny\r\n  return (FLAB.players || []).map(p => {\r\n    // If DOM moved without committing nx,ny, we still pull from layout:\r\n    const el = document.querySelector(`.player[data-id=\"${p.id}\"]`);\r\n    if (el) {\r\n      const r = el.getBoundingClientRect();\r\n      const f = document.querySelector('.flab-field').getBoundingClientRect();\r\n      const cx = (r.left - f.left) + r.width / 2;\r\n      const cy = (r.top - f.top) + r.height / 2;\r\n      const canon = p2n_view(cx, cy);\r\n      return { id: p.id, nx: canon.nx, ny: canon.ny };\r\n    }\r\n    return { id: p.id, nx: p.nx, ny: p.ny };\r\n  });\r\n}\r\n\r\n// Apply preset (replaces current 4-3-3 positions)\r\nexport function applyPlayersCanonical(players) {\r\n  const byId = Object.fromEntries(players.map(p => [String(p.id), p]));\r\n  (FLAB.players || []).forEach(p => {\r\n    const q = byId[String(p.id)];\r\n    if (q) {\r\n      p.nx = q.nx;\r\n      p.ny = q.ny;\r\n    }\r\n  });\r\n  relayoutAllPlayers();\r\n}\r\n\r\n// Export built-in formation for fallback\r\nexport const PRESET_433 = FORMATIONS['4-3-3'];\r\n\r\nwindow.__mod_presets = true;"],
  "mappings": "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",
  "names": ["FLAB", "p2n_view", "relayoutAllPlayers", "FORMATIONS", "upgradeLegacyXY", "p", "__name", "applyPreset", "name", "formation", "slot", "initDrag", "getPresetNames", "snapshotCurrentPlayersCanonical", "el", "r", "f", "cx", "cy", "canon", "applyPlayersCanonical", "players", "byId", "q", "PRESET_433"]
}
