{
  "version": 3,
  "sources": ["../../scripts/presets.js"],
  "sourcesContent": ["// Formation presets module for Formation Lab\nimport { FLAB } from './state.js';\nimport { p2n_view } from './geometry.js';\nimport { relayoutAllPlayers } from './render.js';\nimport { saveUndoState } from './undo-redo.js';\n\n// Formation presets in normalized canonical coordinates\nconst FORMATIONS = {\n  '4-3-3': [\n    { id: 1, role: \"GK\", nx: 0.1, ny: 0.5 },\n    { id: 2, role: \"DF\", nx: 0.25, ny: 0.24 },  // LB nudged inward from 0.2 to 0.24\n    { id: 3, role: \"DF\", nx: 0.25, ny: 0.76 },  // RB nudged inward from 0.8 to 0.76\n    { id: 4, role: \"DF\", nx: 0.35, ny: 0.35 },\n    { id: 5, role: \"DF\", nx: 0.35, ny: 0.65 },\n    { id: 6, role: \"MF\", nx: 0.55, ny: 0.3 },\n    { id: 7, role: \"MF\", nx: 0.55, ny: 0.7 },\n    { id: 8, role: \"MF\", nx: 0.65, ny: 0.5 },\n    { id: 9, role: \"FW\", nx: 0.8, ny: 0.35 },\n    { id: 10, role: \"FW\", nx: 0.8, ny: 0.65 },\n    { id: 11, role: \"FW\", nx: 0.9, ny: 0.5 }\n  ]\n};\n\n// Upgrade legacy coordinates helper\nfunction upgradeLegacyXY(p) {\n  if (p.nx == null || p.ny == null) {\n    p.nx = 0.5;\n    p.ny = 0.5;\n    delete p.x;\n    delete p.y;\n  }\n}\n\n// Apply a formation preset\nexport function applyPreset(name) {\n  const formation = FORMATIONS[name];\n  if (!formation) {\n    console.warn(`Unknown formation preset: ${name}`);\n    return;\n  }\n\n  // Reset state\n  FLAB.players = formation.map(slot => ({\n    id: slot.id,\n    role: slot.role,\n    nx: slot.nx,\n    ny: slot.ny\n  }));\n\n  FLAB.players.forEach(upgradeLegacyXY);\n  FLAB.arrows = [];\n  FLAB.arrowCounter = 1;\n  FLAB.selectedId = null;\n  FLAB.drag = null;\n  FLAB.passArm = null;\n\n  // Import and reinitialize drag system\n  import('./drag.js').then(({ initDrag }) => {\n    initDrag();\n  });\n\n  console.log(`\uD83D\uDCCB Applied formation preset: ${name}`);\n\n  // Save state for undo\n  saveUndoState(`Apply preset: ${name}`);\n}\n\n// Get available preset names\nexport function getPresetNames() {\n  return Object.keys(FORMATIONS);\n}\n\n// Canonical snapshot from current view\nexport function snapshotCurrentPlayersCanonical() {\n  // convert current DOM/view positions back to canonical nx,ny\n  return (FLAB.players || []).map(p => {\n    // If DOM moved without committing nx,ny, we still pull from layout:\n    const el = document.querySelector(`.player[data-id=\"${p.id}\"]`);\n    if (el) {\n      const r = el.getBoundingClientRect();\n      const f = document.querySelector('.flab-field').getBoundingClientRect();\n      const cx = (r.left - f.left) + r.width / 2;\n      const cy = (r.top - f.top) + r.height / 2;\n      const canon = p2n_view(cx, cy);\n      return { id: p.id, nx: canon.nx, ny: canon.ny };\n    }\n    return { id: p.id, nx: p.nx, ny: p.ny };\n  });\n}\n\n// Apply preset (replaces current 4-3-3 positions)\nexport function applyPlayersCanonical(players) {\n  const byId = Object.fromEntries(players.map(p => [String(p.id), p]));\n  (FLAB.players || []).forEach(p => {\n    const q = byId[String(p.id)];\n    if (q) {\n      p.nx = q.nx;\n      p.ny = q.ny;\n    }\n  });\n  relayoutAllPlayers();\n}\n\n// Export built-in formation for fallback\nexport const PRESET_433 = FORMATIONS['4-3-3'];\n\nwindow.__mod_presets = true;"],
  "mappings": "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",
  "names": ["FLAB", "p2n_view", "relayoutAllPlayers", "saveUndoState", "FORMATIONS", "upgradeLegacyXY", "p", "__name", "applyPreset", "name", "formation", "slot", "initDrag", "getPresetNames", "snapshotCurrentPlayersCanonical", "el", "r", "f", "cx", "cy", "canon", "applyPlayersCanonical", "players", "byId", "q", "PRESET_433"]
}
