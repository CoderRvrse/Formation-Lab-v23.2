var D=Object.defineProperty;var c=(e,t)=>D(e,"name",{value:t,configurable:!0});import{FLAB as r,set as O}from"./state.js";import{setOrientation as L,flipSides as N}from"./orientation.js";import{exportPNG as T}from"./export.js";import{snapshotCurrentPlayersCanonical as F,applyPlayersCanonical as B,PRESET_433 as I}from"./presets.js";import{saveSettings as S}from"./persist.js";import{savePreset as q,getDefaultPresetName as k,getPreset as A,setDefaultPreset as _}from"./storage.js";import{logPresetSave as H,logPresetApply as P,logPresetSetDefault as M}from"./logger.js";function E(e){const t=document.getElementById("toastHost");if(!t){console.log(e);return}const o=document.createElement("div");o.className="flab-toast",o.textContent=e,o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),t.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")}),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},3e3)}c(E,"showToast");function R(e){const t=r.mode,o=["select","pass","erase"].includes(e)?e:"select";O("mode",o),document.querySelectorAll(".flab-tool[data-mode], .flab-overlay-btn[data-mode]").forEach(u=>{const i=u.dataset.mode===r.mode;u.setAttribute("aria-pressed",i?"true":"false")}),document.getElementById("arrow-layer")?.classList.toggle("is-interactive",r.mode==="erase"),t!==r.mode&&console.log(`Mode changed from ${t} to ${r.mode}`),r.mode!=="pass"&&(r.passArm=null,import("./aim.js").then(({resetAimRings:u,clearAim:i})=>{u(r.players),i()})),r.drag=null}c(R,"setMode");function U(){const e=k();if(e){const t=A(e);if(t){B(t.players),P(e,t),E(`Formation reset to ${e}`);return}}B(I),P("4-3-3 (built-in)",{players:I}),E("Formation reset to 4-3-3")}c(U,"resetFormation");function K(e="My Preset"){const t=prompt("Preset name:",e);return t&&t.trim()?t.trim():null}c(K,"promptName");function z(){const e=K("4-3-3 tuned");if(!e)return;const t=F();q(e,t),H(e,t),confirm(`Set "${e}" as default?`)&&(_(e),M(e)),E(`Preset saved: ${e}`)}c(z,"handleSavePreset");function G(){const e=k();if(!e){alert("No default preset set yet. Save one first.");return}const t=A(e);if(!t){alert("Default preset missing.");return}B(t.players),P(e,t),E(`Applied preset: ${e}`)}c(G,"handleApplyDefault");function V(){const e=document.getElementById("helpOverlay"),t=document.getElementById("helpButton");e&&(e.setAttribute("aria-hidden","false"),t?.setAttribute("aria-expanded","true"),e.querySelector(".flab-help__close")?.focus())}c(V,"showHelp");function C(){const e=document.getElementById("helpOverlay"),t=document.getElementById("helpButton");e&&(e.setAttribute("aria-hidden","true"),t?.setAttribute("aria-expanded","false"),t?.focus())}c(C,"hideHelp");function j(){console.group("\u2705 Formation Lab v23.4 Acceptance Checklist"),["state","geometry","drag","pass","render","orientation","export","ui"].forEach(o=>{const d=!!window[`__mod_${o}`];console.log(`\u{1F4E6} Module ${o}:`,d?"\u2705 loaded":"\u274C missing")}),console.log("\u{1F3AF} Halo-edge origins:",document.getElementById("flabHalo")?"\u2705 halo present":"\u274C missing"),console.log("\u{1F5B1}\uFE0F  Select/Drag mode:",r.mode==="select"?"\u2705 active":"\u26A0\uFE0F  not active");const t=!!document.querySelector("#arrow-layer #pass-preview");console.log("\u27A1\uFE0F  Pass tool:",t?"\u2705 preview ready":"\u26A0\uFE0F  preview missing"),console.log("\u{1F504} Orientation support:",r.orientation?`\u2705 ${r.orientation}`:"\u274C missing"),console.log("\u{1F4F1} Service worker:","serviceWorker"in navigator?"\u2705 supported":"\u274C not supported"),console.log("\u{1F3F7}\uFE0F  Version consistency:",window.FLAB_VERSION===r.version?"\u2705 matches":"\u26A0\uFE0F  mismatch"),console.assert(!!window.FLAB&&!!window.FLAB_VERSION,"State/version missing"),console.groupEnd()}c(j,"logAcceptanceChecklist");function de(){document.querySelectorAll(".flab-tool[data-mode], .flab-overlay-btn[data-mode], .flab-undo-redo-btn[data-mode]").forEach(n=>{n.addEventListener("click",()=>{R(n.dataset.mode)})}),document.getElementById("exportButton")?.addEventListener("click",T),document.getElementById("resetButton")?.addEventListener("click",U);const o=document.getElementById("btnControlsTab"),d=document.getElementById("pitchControlsSheet");o?.addEventListener("click",n=>{n.stopPropagation(),d?.classList.contains("is-open")?(d.classList.remove("is-open"),o.setAttribute("aria-expanded","false")):(d.classList.add("is-open"),o.setAttribute("aria-expanded","true"))});const h=document.getElementById("btnSavePreset"),u=document.getElementById("btnApplyDefault");h?.addEventListener("click",z),u?.addEventListener("click",G);const i=document.getElementById("btnLandscape"),b=document.getElementById("btnPortrait");i?.addEventListener("click",()=>{import("./orientation.js").then(({autoOrientation:n})=>{const y="ontouchstart"in window||navigator.maxTouchPoints>0,f=window.screen.width<=1024||window.screen.height<=1024,$=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);y&&f||$?(L("landscape"),S({orientation:"landscape"})):import("./fullscreen.js").then(({enterFullscreen:x})=>{x()})})}),b?.addEventListener("click",()=>{L("portrait"),S({orientation:"portrait"})}),document.getElementById("btnFlip")?.addEventListener("click",N);try{const n=localStorage.getItem("flab-aim-assist");if(n!==null){const y=JSON.parse(n);import("./state.js").then(({AIM:f})=>{f.enabled=y})}}catch(n){console.warn("Could not load aim-assist setting:",n)}const l=document.getElementById("helpButton"),a=document.getElementById("closeHelpButton"),p=document.getElementById("helpOverlay");l?.addEventListener("click",V),a?.addEventListener("click",C),p?.addEventListener("click",n=>{n.target===p&&C()});let w;window.addEventListener("resize",()=>{clearTimeout(w),w=setTimeout(()=>{import("./render.js").then(({handleResize:n})=>{n()})},16)}),import("./undo-redo.js").then(({undoManager:n})=>{const y=document.getElementById("btnUndo"),f=document.getElementById("btnRedo");y&&y.addEventListener("click",()=>{n.undo()}),f&&f.addEventListener("click",()=>{n.redo()}),document.addEventListener("keydown",m=>{(m.ctrlKey||m.metaKey)&&m.key==="z"&&!m.shiftKey&&(m.preventDefault(),n.undo()),(m.ctrlKey||m.metaKey)&&(m.key==="y"||m.key==="z"&&m.shiftKey)&&(m.preventDefault(),n.redo())})});const v=document.querySelector(".flab-pitch-wrapper"),g=document.querySelector(".flab-field");v?.addEventListener("click",n=>{if(n.target.closest(".flab-controls-tab")||n.target.closest(".flab-controls-sheet"))return;const y=document.getElementById("pitchControlsSheet"),f=document.getElementById("btnControlsTab");y?.classList.contains("is-open")&&(y.classList.remove("is-open"),f?.setAttribute("aria-expanded","false"))}),J(),setTimeout(j,1e3),console.log("\u{1F3AE} Formation Lab UI initialized")}c(de,"wireUI");function W(){const e=document.getElementById("ball-layer"),t=document.getElementById("arrow-layer"),o=document.getElementById("arrow-group"),d=document.getElementById("arrow-debug-layer")||document.getElementById("ball-debug"),h=e?.children?.length||0,u=d?.children?.length||0,i=t?.children?.length||0,b=o?.children?.length||0,s=document.querySelector("#arrow-group [data-arrow-id] path")||document.querySelector("#arrow-layer [data-arrow-id] path"),l=s?s.getTotalLength().toFixed(1)+"px":"No paths found",a=[];t&&Array.from(t.children).forEach((g,n)=>{a.push(`${n}: ${g.id||g.tagName}`)});const p=[];o&&Array.from(o.children).forEach((g,n)=>{p.push(`  ${n}: ${g.id||g.tagName||"unnamed"}`)});const w=e?.parentNode?.id||"unknown",v=`Ball Playback Diagnostics:

\u{1F3AF} Layer Status:
\u2022 Ball layer children: ${h}
\u2022 Ball layer parent: ${w}
\u2022 Debug layer children: ${u}
\u2022 Arrow layer children: ${i}
\u2022 Arrow group children: ${b}
\u2022 Last pass path length: ${l}

\u{1F4D0} SVG Structure:
#arrow-layer children:
${a.join(`
`)}

#arrow-group children:
${p.join(`
`)}

\u{1F527} Asset Status:
\u2022 Ball URL: ${r.assets?.ballUrl||"Not set"}
\u2022 Ball asset exists: ${!!document.querySelector('[href*="Soccer-ball"]')}

\u{1F4AD} Current State:
\u2022 Pass count: ${r.arrows?.length||0}
\u2022 Current mode: ${r.mode}
\u2022 Animation playing: ${window.currentAnimController?"Yes":"No"}`;console.log(v),E("Diagnostics logged to console \u{1F50D}")}c(W,"showBallPlaybackDiagnostics");function J(){const e=document.getElementById("passPlaybackControls"),t=document.getElementById("btnPlayLast"),o=document.getElementById("btnPlayAll"),d=document.getElementById("btnStopPlayback"),h=document.getElementById("btnDiagnostics");if(!e||!t||!o||!d){console.warn("Pass playback controls not found");return}let u=null;function i(){import("./pass.js").then(({getAllPassIds:s})=>{const a=s().length>0;e.style.display=a?"flex":"none",a?(t.disabled=!1,o.disabled=!1):(t.disabled=!0,o.disabled=!0)}),import("./animate.js").then(({isPlaying:s})=>{const l=s();d.disabled=!l})}c(i,"updateControlStates"),t.addEventListener("click",async()=>{try{const{playPass:s}=await import("./animate.js"),l=r.lastPassId;if(!l){E("No recent pass to play");return}const a=r.arrows.find(p=>p.id===l);a&&(await s(a),i())}catch(s){console.warn("Play last pass failed:",s)}}),o.addEventListener("click",async()=>{try{const{getAllPassIds:s}=await import("./pass.js"),{queuePasses:l}=await import("./animate.js"),a=s();a.length>0&&(u=await l(a),i())}catch(s){console.warn("Play all passes failed:",s)}}),d.addEventListener("click",async()=>{try{const{stopPlayback:s}=await import("./animate.js");s("user-request"),u=null,i()}catch(s){console.warn("Stop playback failed:",s)}}),h&&h.addEventListener("click",()=>{W()}),document.querySelectorAll("[data-proxy]").forEach(s=>{const l=s.getAttribute("data-proxy");l&&s.addEventListener("click",()=>{const a=document.querySelector(l);a&&a.click()})});const b=document.getElementById("arrow-layer");b&&b.addEventListener("click",async s=>{const l=s.target.closest("[data-arrow-id]");if(!l)return;const a=l.dataset.arrowId;if(a)try{const{clearPassHighlight:p,highlightPass:w}=await import("./pass.js");p(),w(a);const{playPass:v}=await import("./animate.js"),g=r.arrows.find(n=>n.id.toString()===a.toString());g&&await v(g)}catch(p){console.warn("Pass click play failed:",p)}}),window.addEventListener("flab:pass",()=>{setTimeout(i,100)}),window.addEventListener("flab:replay-end",()=>{u=null,i()}),setTimeout(i,500)}c(J,"setupPassPlaybackControls"),window.__mod_ui=!0;export{C as hideHelp,E as showToast,de as wireUI};
//# sourceMappingURL=ui.js.map
