var A=Object.defineProperty;var i=(e,t)=>A(e,"name",{value:t,configurable:!0});import{FLAB as s,set as k}from"./state.js";import{setOrientation as B,flipSides as $}from"./orientation.js";import{exportPNG as C}from"./export.js";import{snapshotCurrentPlayersCanonical as D,applyPlayersCanonical as b,PRESET_433 as P}from"./presets.js";import{saveSettings as v}from"./persist.js";import{savePreset as N,getDefaultPresetName as L,getPreset as I,setDefaultPreset as x}from"./storage.js";import{logPresetSave as F,logPresetApply as E,logPresetSetDefault as O}from"./logger.js";function g(e){const t=document.getElementById("toastHost");if(!t){console.log(e);return}const o=document.createElement("div");o.className="flab-toast",o.textContent=e,o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),t.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")}),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},3e3)}i(g,"showToast");function T(e){const t=s.mode,o=["select","pass","erase"].includes(e)?e:"select";k("mode",o),document.querySelectorAll(".flab-tool[data-mode]").forEach(d=>{const c=d.dataset.mode===s.mode;d.setAttribute("aria-pressed",c?"true":"false")}),document.getElementById("arrow-layer")?.classList.toggle("is-interactive",s.mode==="erase"),t!==s.mode&&console.log(`Mode changed from ${t} to ${s.mode}`),s.mode!=="pass"&&(s.passArm=null,import("./aim.js").then(({resetAimRings:d,clearAim:c})=>{d(s.players),c()})),s.drag=null}i(T,"setMode");function _(){const e=L();if(e){const t=I(e);if(t){b(t.players),E(e,t),g(`Formation reset to ${e}`);return}}b(P),E("4-3-3 (built-in)",{players:P}),g("Formation reset to 4-3-3")}i(_,"resetFormation");function q(e="My Preset"){const t=prompt("Preset name:",e);return t&&t.trim()?t.trim():null}i(q,"promptName");function H(){const e=q("4-3-3 tuned");if(!e)return;const t=D();N(e,t),F(e,t),confirm(`Set "${e}" as default?`)&&(x(e),O(e)),g(`Preset saved: ${e}`)}i(H,"handleSavePreset");function G(){const e=L();if(!e){alert("No default preset set yet. Save one first.");return}const t=I(e);if(!t){alert("Default preset missing.");return}b(t.players),E(e,t),g(`Applied preset: ${e}`)}i(G,"handleApplyDefault");function M(){const e=document.getElementById("helpOverlay"),t=document.getElementById("helpButton");e&&(e.setAttribute("aria-hidden","false"),t?.setAttribute("aria-expanded","true"),e.querySelector(".flab-help__close")?.focus())}i(M,"showHelp");function S(){const e=document.getElementById("helpOverlay"),t=document.getElementById("helpButton");e&&(e.setAttribute("aria-hidden","true"),t?.setAttribute("aria-expanded","false"),t?.focus())}i(S,"hideHelp");function R(){console.group("\u2705 Formation Lab v23.4 Acceptance Checklist"),["state","geometry","drag","pass","render","orientation","export","ui"].forEach(o=>{const u=!!window[`__mod_${o}`];console.log(`\u{1F4E6} Module ${o}:`,u?"\u2705 loaded":"\u274C missing")}),console.log("\u{1F3AF} Halo-edge origins:",document.getElementById("flabHalo")?"\u2705 halo present":"\u274C missing"),console.log("\u{1F5B1}\uFE0F  Select/Drag mode:",s.mode==="select"?"\u2705 active":"\u26A0\uFE0F  not active");const t=!!document.querySelector("#arrow-layer #pass-preview");console.log("\u27A1\uFE0F  Pass tool:",t?"\u2705 preview ready":"\u26A0\uFE0F  preview missing"),console.log("\u{1F504} Orientation support:",s.orientation?`\u2705 ${s.orientation}`:"\u274C missing"),console.log("\u{1F4F1} Service worker:","serviceWorker"in navigator?"\u2705 supported":"\u274C not supported"),console.log("\u{1F3F7}\uFE0F  Version consistency:",window.FLAB_VERSION===s.version?"\u2705 matches":"\u26A0\uFE0F  mismatch"),console.assert(!!window.FLAB&&!!window.FLAB_VERSION,"State/version missing"),console.groupEnd()}i(R,"logAcceptanceChecklist");function ae(){document.querySelectorAll(".flab-tool[data-mode]").forEach(a=>{a.addEventListener("click",()=>{T(a.dataset.mode)})}),document.getElementById("exportButton")?.addEventListener("click",C),document.getElementById("resetButton")?.addEventListener("click",_);const o=document.getElementById("btnSavePreset"),u=document.getElementById("btnApplyDefault");o?.addEventListener("click",H),u?.addEventListener("click",G);const p=document.getElementById("btnLandscape"),d=document.getElementById("btnPortrait");p?.addEventListener("click",()=>{B("landscape"),v({orientation:"landscape"})}),d?.addEventListener("click",()=>{B("portrait"),v({orientation:"portrait"})}),document.getElementById("btnFlip")?.addEventListener("click",$);try{const a=localStorage.getItem("flab-aim-assist");if(a!==null){const f=JSON.parse(a);import("./state.js").then(({AIM:h})=>{h.enabled=f})}}catch(a){console.warn("Could not load aim-assist setting:",a)}const y=document.getElementById("helpButton"),n=document.getElementById("closeHelpButton"),l=document.getElementById("helpOverlay");y?.addEventListener("click",M),n?.addEventListener("click",S),l?.addEventListener("click",a=>{a.target===l&&S()});let r;window.addEventListener("resize",()=>{clearTimeout(r),r=setTimeout(()=>{import("./render.js").then(({handleResize:a})=>{a()})},16)}),V(),setTimeout(R,1e3),console.log("\u{1F3AE} Formation Lab UI initialized")}i(ae,"wireUI");function U(){const e=document.getElementById("ball-layer"),t=document.getElementById("arrow-layer"),o=document.getElementById("arrow-group"),u=document.getElementById("arrow-debug-layer")||document.getElementById("ball-debug"),p=e?.children?.length||0,d=u?.children?.length||0,c=t?.children?.length||0,y=o?.children?.length||0,n=document.querySelector("#arrow-group [data-arrow-id] path")||document.querySelector("#arrow-layer [data-arrow-id] path"),l=n?n.getTotalLength().toFixed(1)+"px":"No paths found",r=[];t&&Array.from(t.children).forEach((m,w)=>{r.push(`${w}: ${m.id||m.tagName}`)});const a=[];o&&Array.from(o.children).forEach((m,w)=>{a.push(`  ${w}: ${m.id||m.tagName||"unnamed"}`)});const f=e?.parentNode?.id||"unknown",h=`Ball Playback Diagnostics:

\u{1F3AF} Layer Status:
\u2022 Ball layer children: ${p}
\u2022 Ball layer parent: ${f}
\u2022 Debug layer children: ${d}
\u2022 Arrow layer children: ${c}
\u2022 Arrow group children: ${y}
\u2022 Last pass path length: ${l}

\u{1F4D0} SVG Structure:
#arrow-layer children:
${r.join(`
`)}

#arrow-group children:
${a.join(`
`)}

\u{1F527} Asset Status:
\u2022 Ball URL: ${s.assets?.ballUrl||"Not set"}
\u2022 Ball asset exists: ${!!document.querySelector('[href*="Soccer-ball"]')}

\u{1F4AD} Current State:
\u2022 Pass count: ${s.arrows?.length||0}
\u2022 Current mode: ${s.mode}
\u2022 Animation playing: ${window.currentAnimController?"Yes":"No"}`;console.log(h),g("Diagnostics logged to console \u{1F50D}")}i(U,"showBallPlaybackDiagnostics");function V(){const e=document.getElementById("passPlaybackControls"),t=document.getElementById("btnPlayLast"),o=document.getElementById("btnPlayAll"),u=document.getElementById("btnStopPlayback"),p=document.getElementById("btnDiagnostics");if(!e||!t||!o||!u){console.warn("Pass playback controls not found");return}let d=null;function c(){import("./pass.js").then(({getAllPassIds:n})=>{const r=n().length>0;e.style.display=r?"flex":"none",r?(t.disabled=!1,o.disabled=!1):(t.disabled=!0,o.disabled=!0)}),import("./animate.js").then(({isPlaying:n})=>{const l=n();u.disabled=!l})}i(c,"updateControlStates"),t.addEventListener("click",async()=>{try{const{playPass:n}=await import("./animate.js"),l=s.lastPassId;if(!l){g("No recent pass to play");return}const r=s.arrows.find(a=>a.id===l);r&&(await n(r),c())}catch(n){console.warn("Play last pass failed:",n)}}),o.addEventListener("click",async()=>{try{const{getAllPassIds:n}=await import("./pass.js"),{queuePasses:l}=await import("./animate.js"),r=n();r.length>0&&(d=await l(r),c())}catch(n){console.warn("Play all passes failed:",n)}}),u.addEventListener("click",async()=>{try{const{stopPlayback:n}=await import("./animate.js");n("user-request"),d=null,c()}catch(n){console.warn("Stop playback failed:",n)}}),p&&p.addEventListener("click",()=>{U()});const y=document.getElementById("arrow-layer");y&&y.addEventListener("click",async n=>{const l=n.target.closest("[data-arrow-id]");if(!l)return;const r=l.dataset.arrowId;if(r)try{const{clearPassHighlight:a,highlightPass:f}=await import("./pass.js");a(),f(r);const{playPass:h}=await import("./animate.js"),m=s.arrows.find(w=>w.id.toString()===r.toString());m&&await h(m)}catch(a){console.warn("Pass click play failed:",a)}}),window.addEventListener("flab:pass",()=>{setTimeout(c,100)}),window.addEventListener("flab:replay-end",()=>{d=null,c()}),setTimeout(c,500)}i(V,"setupPassPlaybackControls"),window.__mod_ui=!0;export{S as hideHelp,g as showToast,ae as wireUI};
//# sourceMappingURL=ui.js.map
