var A=Object.defineProperty;var c=(e,t)=>A(e,"name",{value:t,configurable:!0});import{FLAB as l,set as $}from"./state.js";import{setOrientation as v,flipSides as C}from"./orientation.js";import{exportPNG as D}from"./export.js";import{snapshotCurrentPlayersCanonical as x,applyPlayersCanonical as b,PRESET_433 as B}from"./presets.js";import{saveSettings as P}from"./persist.js";import{savePreset as N,getDefaultPresetName as L,getPreset as I,setDefaultPreset as O}from"./storage.js";import{logPresetSave as F,logPresetApply as E,logPresetSetDefault as T}from"./logger.js";function w(e){const t=document.getElementById("toastHost");if(!t){console.log(e);return}const o=document.createElement("div");o.className="flab-toast",o.textContent=e,o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),t.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")}),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},3e3)}c(w,"showToast");function q(e){const t=l.mode,o=["select","pass","erase"].includes(e)?e:"select";$("mode",o),document.querySelectorAll(".flab-tool[data-mode], .flab-overlay-btn[data-mode]").forEach(u=>{const d=u.dataset.mode===l.mode;u.setAttribute("aria-pressed",d?"true":"false")}),document.getElementById("arrow-layer")?.classList.toggle("is-interactive",l.mode==="erase"),t!==l.mode&&console.log(`Mode changed from ${t} to ${l.mode}`),l.mode!=="pass"&&(l.passArm=null,import("./aim.js").then(({resetAimRings:u,clearAim:d})=>{u(l.players),d()})),l.drag=null}c(q,"setMode");function _(){const e=L();if(e){const t=I(e);if(t){b(t.players),E(e,t),w(`Formation reset to ${e}`);return}}b(B),E("4-3-3 (built-in)",{players:B}),w("Formation reset to 4-3-3")}c(_,"resetFormation");function H(e="My Preset"){const t=prompt("Preset name:",e);return t&&t.trim()?t.trim():null}c(H,"promptName");function M(){const e=H("4-3-3 tuned");if(!e)return;const t=x();N(e,t),F(e,t),confirm(`Set "${e}" as default?`)&&(O(e),T(e)),w(`Preset saved: ${e}`)}c(M,"handleSavePreset");function R(){const e=L();if(!e){alert("No default preset set yet. Save one first.");return}const t=I(e);if(!t){alert("Default preset missing.");return}b(t.players),E(e,t),w(`Applied preset: ${e}`)}c(R,"handleApplyDefault");function U(){const e=document.getElementById("helpOverlay"),t=document.getElementById("helpButton");e&&(e.setAttribute("aria-hidden","false"),t?.setAttribute("aria-expanded","true"),e.querySelector(".flab-help__close")?.focus())}c(U,"showHelp");function S(){const e=document.getElementById("helpOverlay"),t=document.getElementById("helpButton");e&&(e.setAttribute("aria-hidden","true"),t?.setAttribute("aria-expanded","false"),t?.focus())}c(S,"hideHelp");function K(){console.group("\u2705 Formation Lab v23.4 Acceptance Checklist"),["state","geometry","drag","pass","render","orientation","export","ui"].forEach(o=>{const m=!!window[`__mod_${o}`];console.log(`\u{1F4E6} Module ${o}:`,m?"\u2705 loaded":"\u274C missing")}),console.log("\u{1F3AF} Halo-edge origins:",document.getElementById("flabHalo")?"\u2705 halo present":"\u274C missing"),console.log("\u{1F5B1}\uFE0F  Select/Drag mode:",l.mode==="select"?"\u2705 active":"\u26A0\uFE0F  not active");const t=!!document.querySelector("#arrow-layer #pass-preview");console.log("\u27A1\uFE0F  Pass tool:",t?"\u2705 preview ready":"\u26A0\uFE0F  preview missing"),console.log("\u{1F504} Orientation support:",l.orientation?`\u2705 ${l.orientation}`:"\u274C missing"),console.log("\u{1F4F1} Service worker:","serviceWorker"in navigator?"\u2705 supported":"\u274C not supported"),console.log("\u{1F3F7}\uFE0F  Version consistency:",window.FLAB_VERSION===l.version?"\u2705 matches":"\u26A0\uFE0F  mismatch"),console.assert(!!window.FLAB&&!!window.FLAB_VERSION,"State/version missing"),console.groupEnd()}c(K,"logAcceptanceChecklist");function re(){document.querySelectorAll(".flab-tool[data-mode], .flab-overlay-btn[data-mode], .flab-undo-redo-btn[data-mode]").forEach(n=>{n.addEventListener("click",()=>{q(n.dataset.mode)})}),document.getElementById("exportButton")?.addEventListener("click",D),document.getElementById("resetButton")?.addEventListener("click",_);const o=document.getElementById("btnSavePreset"),m=document.getElementById("btnApplyDefault");o?.addEventListener("click",M),m?.addEventListener("click",R);const g=document.getElementById("btnLandscape"),u=document.getElementById("btnPortrait");g?.addEventListener("click",()=>{import("./orientation.js").then(({autoOrientation:n})=>{const p="ontouchstart"in window||navigator.maxTouchPoints>0,y=window.screen.width<=1024||window.screen.height<=1024,f=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);p&&y||f?(v("landscape"),P({orientation:"landscape"})):import("./fullscreen.js").then(({enterFullscreen:k})=>{k()})})}),u?.addEventListener("click",()=>{v("portrait"),P({orientation:"portrait"})}),document.getElementById("btnFlip")?.addEventListener("click",C);try{const n=localStorage.getItem("flab-aim-assist");if(n!==null){const p=JSON.parse(n);import("./state.js").then(({AIM:y})=>{y.enabled=p})}}catch(n){console.warn("Could not load aim-assist setting:",n)}const h=document.getElementById("helpButton"),a=document.getElementById("closeHelpButton"),i=document.getElementById("helpOverlay");h?.addEventListener("click",U),a?.addEventListener("click",S),i?.addEventListener("click",n=>{n.target===i&&S()});let s;window.addEventListener("resize",()=>{clearTimeout(s),s=setTimeout(()=>{import("./render.js").then(({handleResize:n})=>{n()})},16)}),import("./undo-redo.js").then(({undoManager:n})=>{const p=document.getElementById("btnUndo"),y=document.getElementById("btnRedo");p&&p.addEventListener("click",()=>{n.undo()}),y&&y.addEventListener("click",()=>{n.redo()}),document.addEventListener("keydown",r=>{(r.ctrlKey||r.metaKey)&&r.key==="z"&&!r.shiftKey&&(r.preventDefault(),n.undo()),(r.ctrlKey||r.metaKey)&&(r.key==="y"||r.key==="z"&&r.shiftKey)&&(r.preventDefault(),n.redo())})}),G(),setTimeout(K,1e3),console.log("\u{1F3AE} Formation Lab UI initialized")}c(re,"wireUI");function z(){const e=document.getElementById("ball-layer"),t=document.getElementById("arrow-layer"),o=document.getElementById("arrow-group"),m=document.getElementById("arrow-debug-layer")||document.getElementById("ball-debug"),g=e?.children?.length||0,u=m?.children?.length||0,d=t?.children?.length||0,h=o?.children?.length||0,a=document.querySelector("#arrow-group [data-arrow-id] path")||document.querySelector("#arrow-layer [data-arrow-id] path"),i=a?a.getTotalLength().toFixed(1)+"px":"No paths found",s=[];t&&Array.from(t.children).forEach((r,f)=>{s.push(`${f}: ${r.id||r.tagName}`)});const n=[];o&&Array.from(o.children).forEach((r,f)=>{n.push(`  ${f}: ${r.id||r.tagName||"unnamed"}`)});const p=e?.parentNode?.id||"unknown",y=`Ball Playback Diagnostics:

\u{1F3AF} Layer Status:
\u2022 Ball layer children: ${g}
\u2022 Ball layer parent: ${p}
\u2022 Debug layer children: ${u}
\u2022 Arrow layer children: ${d}
\u2022 Arrow group children: ${h}
\u2022 Last pass path length: ${i}

\u{1F4D0} SVG Structure:
#arrow-layer children:
${s.join(`
`)}

#arrow-group children:
${n.join(`
`)}

\u{1F527} Asset Status:
\u2022 Ball URL: ${l.assets?.ballUrl||"Not set"}
\u2022 Ball asset exists: ${!!document.querySelector('[href*="Soccer-ball"]')}

\u{1F4AD} Current State:
\u2022 Pass count: ${l.arrows?.length||0}
\u2022 Current mode: ${l.mode}
\u2022 Animation playing: ${window.currentAnimController?"Yes":"No"}`;console.log(y),w("Diagnostics logged to console \u{1F50D}")}c(z,"showBallPlaybackDiagnostics");function G(){const e=document.getElementById("passPlaybackControls"),t=document.getElementById("btnPlayLast"),o=document.getElementById("btnPlayAll"),m=document.getElementById("btnStopPlayback"),g=document.getElementById("btnDiagnostics");if(!e||!t||!o||!m){console.warn("Pass playback controls not found");return}let u=null;function d(){import("./pass.js").then(({getAllPassIds:a})=>{const s=a().length>0;e.style.display=s?"flex":"none",s?(t.disabled=!1,o.disabled=!1):(t.disabled=!0,o.disabled=!0)}),import("./animate.js").then(({isPlaying:a})=>{const i=a();m.disabled=!i})}c(d,"updateControlStates"),t.addEventListener("click",async()=>{try{const{playPass:a}=await import("./animate.js"),i=l.lastPassId;if(!i){w("No recent pass to play");return}const s=l.arrows.find(n=>n.id===i);s&&(await a(s),d())}catch(a){console.warn("Play last pass failed:",a)}}),o.addEventListener("click",async()=>{try{const{getAllPassIds:a}=await import("./pass.js"),{queuePasses:i}=await import("./animate.js"),s=a();s.length>0&&(u=await i(s),d())}catch(a){console.warn("Play all passes failed:",a)}}),m.addEventListener("click",async()=>{try{const{stopPlayback:a}=await import("./animate.js");a("user-request"),u=null,d()}catch(a){console.warn("Stop playback failed:",a)}}),g&&g.addEventListener("click",()=>{z()}),document.querySelectorAll("[data-proxy]").forEach(a=>{const i=a.getAttribute("data-proxy");i&&a.addEventListener("click",()=>{const s=document.querySelector(i);s&&s.click()})});const h=document.getElementById("arrow-layer");h&&h.addEventListener("click",async a=>{const i=a.target.closest("[data-arrow-id]");if(!i)return;const s=i.dataset.arrowId;if(s)try{const{clearPassHighlight:n,highlightPass:p}=await import("./pass.js");n(),p(s);const{playPass:y}=await import("./animate.js"),r=l.arrows.find(f=>f.id.toString()===s.toString());r&&await y(r)}catch(n){console.warn("Pass click play failed:",n)}}),window.addEventListener("flab:pass",()=>{setTimeout(d,100)}),window.addEventListener("flab:replay-end",()=>{u=null,d()}),setTimeout(d,500)}c(G,"setupPassPlaybackControls"),window.__mod_ui=!0;export{S as hideHelp,w as showToast,re as wireUI};
//# sourceMappingURL=ui.js.map
