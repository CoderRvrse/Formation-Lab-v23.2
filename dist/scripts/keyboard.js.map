{
  "version": 3,
  "sources": ["../../scripts/keyboard.js"],
  "sourcesContent": ["// Keyboard module for Formation Lab\nimport { FLAB } from './state.js';\n\n// Global keyboard navigation\nfunction handleGlobalKeydown(evt) {\n  if (evt.key === \"Escape\") {\n    // Import ui to hide help\n    import('./ui.js').then(({ hideHelp }) => {\n      hideHelp();\n    });\n\n    // Cancel any active drag or pass\n    if (FLAB.drag || FLAB.passArm) {\n      FLAB.drag = null;\n      FLAB.passArm = null;\n\n      // Import render to update\n      import('./render.js').then(({ renderArrows }) => {\n        renderArrows();\n      });\n    }\n\n    return;\n  }\n\n  if (evt.key === \"Tab\" && !evt.ctrlKey && !evt.altKey && !evt.metaKey) {\n    // Cycle through players\n    evt.preventDefault();\n    const playerIds = FLAB.players.map(p => p.id).sort((a, b) => a - b);\n    if (playerIds.length === 0) return;\n\n    const currentIndex = playerIds.indexOf(FLAB.selectedId);\n    const nextIndex = evt.shiftKey\n      ? (currentIndex <= 0 ? playerIds.length - 1 : currentIndex - 1)\n      : (currentIndex >= playerIds.length - 1 ? 0 : currentIndex + 1);\n\n    FLAB.selectedId = playerIds[nextIndex];\n\n    // Import render to update halo\n    import('./render.js').then(({ updateHalo }) => {\n      updateHalo();\n    });\n\n    // Focus the selected player\n    const playerEl = document.querySelector(`.flab-player[data-id=\"${FLAB.selectedId}\"]`);\n    playerEl?.focus();\n\n    return;\n  }\n\n  // Arrow key nudging for selected player\n  if (FLAB.selectedId && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(evt.key)) {\n    evt.preventDefault();\n\n    const player = FLAB.players.find(p => p.id === FLAB.selectedId);\n    if (!player) return;\n\n    const step = evt.shiftKey ? 0.1 : 0.01; // Large steps with Shift\n\n    if (evt.key === \"ArrowUp\") player.ny -= step;\n    if (evt.key === \"ArrowDown\") player.ny += step;\n    if (evt.key === \"ArrowLeft\") player.nx -= step;\n    if (evt.key === \"ArrowRight\") player.nx += step;\n\n    // Clamp to bounds\n    player.nx = Math.min(1, Math.max(0, player.nx));\n    player.ny = Math.min(1, Math.max(0, player.ny));\n\n    // Import render to update\n    import('./render.js').then(({ renderPlayers, updateHalo, renderArrows }) => {\n      renderPlayers();\n      updateHalo();\n      renderArrows();\n    });\n  }\n}\n\n// Initialize keyboard handling\nexport function initKeyboard() {\n  document.addEventListener('keydown', handleGlobalKeydown);\n  console.log('\u2328\uFE0F Keyboard navigation initialized');\n}\n\nwindow.__mod_keyboard = true;"],
  "mappings": "+EACA,OAAS,QAAAA,MAAY,aAGrB,SAASC,EAAoBC,EAAK,CAChC,GAAIA,EAAI,MAAQ,SAAU,CAExB,OAAO,SAAS,EAAE,KAAK,CAAC,CAAE,SAAAC,CAAS,IAAM,CACvCA,EAAS,CACX,CAAC,GAGGH,EAAK,MAAQA,EAAK,WACpBA,EAAK,KAAO,KACZA,EAAK,QAAU,KAGf,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,aAAAI,CAAa,IAAM,CAC/CA,EAAa,CACf,CAAC,GAGH,MACF,CAEA,GAAIF,EAAI,MAAQ,OAAS,CAACA,EAAI,SAAW,CAACA,EAAI,QAAU,CAACA,EAAI,QAAS,CAEpEA,EAAI,eAAe,EACnB,MAAMG,EAAYL,EAAK,QAAQ,IAAIM,GAAKA,EAAE,EAAE,EAAE,KAAK,CAACC,EAAGC,IAAMD,EAAIC,CAAC,EAClE,GAAIH,EAAU,SAAW,EAAG,OAE5B,MAAMI,EAAeJ,EAAU,QAAQL,EAAK,UAAU,EAChDU,EAAYR,EAAI,SACjBO,GAAgB,EAAIJ,EAAU,OAAS,EAAII,EAAe,EAC1DA,GAAgBJ,EAAU,OAAS,EAAI,EAAII,EAAe,EAE/DT,EAAK,WAAaK,EAAUK,CAAS,EAGrC,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,WAAAC,CAAW,IAAM,CAC7CA,EAAW,CACb,CAAC,EAGgB,SAAS,cAAc,yBAAyBX,EAAK,UAAU,IAAI,GAC1E,MAAM,EAEhB,MACF,CAGA,GAAIA,EAAK,YAAc,CAAC,UAAW,YAAa,YAAa,YAAY,EAAE,SAASE,EAAI,GAAG,EAAG,CAC5FA,EAAI,eAAe,EAEnB,MAAMU,EAASZ,EAAK,QAAQ,KAAKM,GAAKA,EAAE,KAAON,EAAK,UAAU,EAC9D,GAAI,CAACY,EAAQ,OAEb,MAAMC,EAAOX,EAAI,SAAW,GAAM,IAE9BA,EAAI,MAAQ,YAAWU,EAAO,IAAMC,GACpCX,EAAI,MAAQ,cAAaU,EAAO,IAAMC,GACtCX,EAAI,MAAQ,cAAaU,EAAO,IAAMC,GACtCX,EAAI,MAAQ,eAAcU,EAAO,IAAMC,GAG3CD,EAAO,GAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,EAAO,EAAE,CAAC,EAC9CA,EAAO,GAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,EAAO,EAAE,CAAC,EAG9C,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,cAAAE,EAAe,WAAAH,EAAY,aAAAP,CAAa,IAAM,CAC1EU,EAAc,EACdH,EAAW,EACXP,EAAa,CACf,CAAC,CACH,CACF,CAvESW,EAAAd,EAAA,uBA0EF,SAASe,GAAe,CAC7B,SAAS,iBAAiB,UAAWf,CAAmB,EACxD,QAAQ,IAAI,8CAAoC,CAClD,CAHgBc,EAAAC,EAAA,gBAKhB,OAAO,eAAiB",
  "names": ["FLAB", "handleGlobalKeydown", "evt", "hideHelp", "renderArrows", "playerIds", "p", "a", "b", "currentIndex", "nextIndex", "updateHalo", "player", "step", "renderPlayers", "__name", "initKeyboard"]
}
