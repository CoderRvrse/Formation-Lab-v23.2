{
  "version": 3,
  "sources": ["../../scripts/keyboard.js"],
  "sourcesContent": ["// Keyboard module for Formation Lab\r\nimport { FLAB } from './state.js';\r\n\r\n// Global keyboard navigation\r\nfunction handleGlobalKeydown(evt) {\r\n  if (evt.key === \"Escape\") {\r\n    // Import ui to hide help\r\n    import('./ui.js').then(({ hideHelp }) => {\r\n      hideHelp();\r\n    });\r\n\r\n    // Cancel any active drag or pass\r\n    if (FLAB.drag || FLAB.passArm) {\r\n      FLAB.drag = null;\r\n      FLAB.passArm = null;\r\n\r\n      // Import render to update\r\n      import('./render.js').then(({ renderArrows }) => {\r\n        renderArrows();\r\n      });\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if (evt.key === \"Tab\" && !evt.ctrlKey && !evt.altKey && !evt.metaKey) {\r\n    // Cycle through players\r\n    evt.preventDefault();\r\n    const playerIds = FLAB.players.map(p => p.id).sort((a, b) => a - b);\r\n    if (playerIds.length === 0) return;\r\n\r\n    const currentIndex = playerIds.indexOf(FLAB.selectedId);\r\n    const nextIndex = evt.shiftKey\r\n      ? (currentIndex <= 0 ? playerIds.length - 1 : currentIndex - 1)\r\n      : (currentIndex >= playerIds.length - 1 ? 0 : currentIndex + 1);\r\n\r\n    FLAB.selectedId = playerIds[nextIndex];\r\n\r\n    // Import render to update halo\r\n    import('./render.js').then(({ updateHalo }) => {\r\n      updateHalo();\r\n    });\r\n\r\n    // Focus the selected player\r\n    const playerEl = document.querySelector(`.flab-player[data-id=\"${FLAB.selectedId}\"]`);\r\n    playerEl?.focus();\r\n\r\n    return;\r\n  }\r\n\r\n  // Arrow key nudging for selected player\r\n  if (FLAB.selectedId && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(evt.key)) {\r\n    evt.preventDefault();\r\n\r\n    const player = FLAB.players.find(p => p.id === FLAB.selectedId);\r\n    if (!player) return;\r\n\r\n    const step = evt.shiftKey ? 0.1 : 0.01; // Large steps with Shift\r\n\r\n    if (evt.key === \"ArrowUp\") player.ny -= step;\r\n    if (evt.key === \"ArrowDown\") player.ny += step;\r\n    if (evt.key === \"ArrowLeft\") player.nx -= step;\r\n    if (evt.key === \"ArrowRight\") player.nx += step;\r\n\r\n    // Clamp to bounds\r\n    player.nx = Math.min(1, Math.max(0, player.nx));\r\n    player.ny = Math.min(1, Math.max(0, player.ny));\r\n\r\n    // Import render to update\r\n    import('./render.js').then(({ renderPlayers, updateHalo, renderArrows }) => {\r\n      renderPlayers();\r\n      updateHalo();\r\n      renderArrows();\r\n    });\r\n  }\r\n}\r\n\r\n// Initialize keyboard handling\r\nexport function initKeyboard() {\r\n  document.addEventListener('keydown', handleGlobalKeydown);\r\n  console.log('\u2328\uFE0F Keyboard navigation initialized');\r\n}\r\n\r\nwindow.__mod_keyboard = true;"],
  "mappings": "+EACA,OAAS,QAAAA,MAAY,aAGrB,SAASC,EAAoBC,EAAK,CAChC,GAAIA,EAAI,MAAQ,SAAU,CAExB,OAAO,SAAS,EAAE,KAAK,CAAC,CAAE,SAAAC,CAAS,IAAM,CACvCA,EAAS,CACX,CAAC,GAGGH,EAAK,MAAQA,EAAK,WACpBA,EAAK,KAAO,KACZA,EAAK,QAAU,KAGf,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,aAAAI,CAAa,IAAM,CAC/CA,EAAa,CACf,CAAC,GAGH,MACF,CAEA,GAAIF,EAAI,MAAQ,OAAS,CAACA,EAAI,SAAW,CAACA,EAAI,QAAU,CAACA,EAAI,QAAS,CAEpEA,EAAI,eAAe,EACnB,MAAMG,EAAYL,EAAK,QAAQ,IAAIM,GAAKA,EAAE,EAAE,EAAE,KAAK,CAACC,EAAGC,IAAMD,EAAIC,CAAC,EAClE,GAAIH,EAAU,SAAW,EAAG,OAE5B,MAAMI,EAAeJ,EAAU,QAAQL,EAAK,UAAU,EAChDU,EAAYR,EAAI,SACjBO,GAAgB,EAAIJ,EAAU,OAAS,EAAII,EAAe,EAC1DA,GAAgBJ,EAAU,OAAS,EAAI,EAAII,EAAe,EAE/DT,EAAK,WAAaK,EAAUK,CAAS,EAGrC,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,WAAAC,CAAW,IAAM,CAC7CA,EAAW,CACb,CAAC,EAGgB,SAAS,cAAc,yBAAyBX,EAAK,UAAU,IAAI,GAC1E,MAAM,EAEhB,MACF,CAGA,GAAIA,EAAK,YAAc,CAAC,UAAW,YAAa,YAAa,YAAY,EAAE,SAASE,EAAI,GAAG,EAAG,CAC5FA,EAAI,eAAe,EAEnB,MAAMU,EAASZ,EAAK,QAAQ,KAAKM,GAAKA,EAAE,KAAON,EAAK,UAAU,EAC9D,GAAI,CAACY,EAAQ,OAEb,MAAMC,EAAOX,EAAI,SAAW,GAAM,IAE9BA,EAAI,MAAQ,YAAWU,EAAO,IAAMC,GACpCX,EAAI,MAAQ,cAAaU,EAAO,IAAMC,GACtCX,EAAI,MAAQ,cAAaU,EAAO,IAAMC,GACtCX,EAAI,MAAQ,eAAcU,EAAO,IAAMC,GAG3CD,EAAO,GAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,EAAO,EAAE,CAAC,EAC9CA,EAAO,GAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,EAAO,EAAE,CAAC,EAG9C,OAAO,aAAa,EAAE,KAAK,CAAC,CAAE,cAAAE,EAAe,WAAAH,EAAY,aAAAP,CAAa,IAAM,CAC1EU,EAAc,EACdH,EAAW,EACXP,EAAa,CACf,CAAC,CACH,CACF,CAvESW,EAAAd,EAAA,uBA0EF,SAASe,GAAe,CAC7B,SAAS,iBAAiB,UAAWf,CAAmB,EACxD,QAAQ,IAAI,8CAAoC,CAClD,CAHgBc,EAAAC,EAAA,gBAKhB,OAAO,eAAiB",
  "names": ["FLAB", "handleGlobalKeydown", "evt", "hideHelp", "renderArrows", "playerIds", "p", "a", "b", "currentIndex", "nextIndex", "updateHalo", "player", "step", "renderPlayers", "__name", "initKeyboard"]
}
