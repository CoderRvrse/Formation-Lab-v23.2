<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Formation Lab v23.4.7.1</title>
    <meta name="description" content="Formation Lab v23.4.7.1 â€“ youth soccer tactics board with drag, pass arrows, and export." />
    <link rel="icon" type="image/png" href="assets/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles/main.css?v=23.4.7.2" />
    <link rel="stylesheet" href="styles/light-mode.css?v=23.4.7.2" />
  </head>
  <body class="flab-body">
    <noscript class="flab-noscript">Formation Lab requires JavaScript to run. Please enable it to use the tactics editor.</noscript>

    <!-- PITCH CANVAS -->
    <main class="flab-app" data-version="v23.4.7.1">
      <section class="flab-pitch-wrapper" aria-label="Pitch canvas">
        <!-- Four corner accent markers for animated border effects -->
        <div class="flab-corner-marker flab-corner--top-left" aria-hidden="true"></div>
        <div class="flab-corner-marker flab-corner--top-right" aria-hidden="true"></div>
        <div class="flab-corner-marker flab-corner--bottom-right" aria-hidden="true"></div>
        <div class="flab-corner-marker flab-corner--bottom-left" aria-hidden="true"></div>

        <!-- Animated connecting lines between corners -->
        <svg class="flab-corner-lines" aria-hidden="true" width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none">
          <defs>
            <path id="pathTop" d="M 0,8 L 100,8" fill="none" />
            <path id="pathRight" d="M 98,0 L 98,100" fill="none" />
            <path id="pathBottom" d="M 100,92 L 0,92" fill="none" />
            <path id="pathLeft" d="M 2,98 L 2,2" fill="none" />
          </defs>

          <line class="flab-corner-line flab-line--top" x1="0" y1="0" x2="100%" y2="0"></line>
          <line class="flab-corner-line flab-line--right" x1="100%" y1="0" x2="100%" y2="100%"></line>
          <line class="flab-corner-line flab-line--bottom" x1="100%" y1="100%" x2="0" y2="100%"></line>
          <line class="flab-corner-line flab-line--left" x1="0" y1="100%" x2="0" y2="0"></line>

          <!-- Animated text along left border (scrolling down) -->
          <text class="flab-border-text flab-border-text--left" font-family="Montserrat, Futura, Century Gothic, Arial Black, sans-serif" font-size="0.5" font-weight="900" fill="rgba(156, 39, 176, 0.95)" letter-spacing="-0.05">
            <textPath href="#pathLeft" startOffset="0%" text-anchor="middle" spacing="auto">
              FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢
            </textPath>
          </text>

          <!-- Animated text along right border (scrolling up) -->
          <text class="flab-border-text flab-border-text--right" font-family="Montserrat, Futura, Century Gothic, Arial Black, sans-serif" font-size="0.5" font-weight="900" fill="rgba(156, 39, 176, 0.95)" letter-spacing="-0.05">
            <textPath href="#pathRight" startOffset="0%" text-anchor="middle" spacing="auto">
              FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢ FC BARCELONA â€¢
            </textPath>
          </text>
        </svg>

        <div class="flab-field" id="pitchMount" data-field-version="v23.4">
          <svg class="flab-arrow-layer" id="arrow-layer" width="100%" height="100%" role="img" aria-label="Pass arrows">
            <defs>
              <!-- Clip to rounded pitch -->
              <clipPath id="pitchClip">
                <rect x="0" y="0" width="100%" height="100%" rx="16" ry="16"></rect>
              </clipPath>
              <!-- Solid -->
              <marker id="passHead-solid" markerUnits="userSpaceOnUse" orient="auto"
                      refX="12" refY="8" markerWidth="12" markerHeight="12">
                <image href="assets/arrows/head-solid.svg" x="0" y="0" width="24" height="16"/>
              </marker>

              <!-- Comic Flat -->
              <marker id="passHead-comic-flat" markerUnits="userSpaceOnUse" orient="auto"
                      refX="14" refY="11" markerWidth="14" markerHeight="14">
                <image href="assets/arrows/head-comic-flat.svg" x="0" y="0" width="28" height="22"/>
              </marker>

              <!-- Comic Halftone -->
              <marker id="passHead-comic-halftone" markerUnits="userSpaceOnUse" orient="auto"
                      refX="14" refY="11" markerWidth="14" markerHeight="14">
                <image href="assets/arrows/head-comic-halftone.svg" x="0" y="0" width="28" height="22"/>
              </marker>
            </defs>
            <g id="arrow-group" clip-path="url(#pitchClip)"></g>
          </svg>
          <div class="flab-players" role="presentation"></div>
          <div class="flab-halo" id="flabHalo" aria-hidden="true"></div>
          <div class="flab-toast-host" id="toastHost" aria-live="polite" aria-atomic="true"></div>
          <div class="flab-fullscreen-controls" id="fullscreenControlsOverlay" aria-hidden="true"></div>

          <!-- Top center Select/Pass/Theme buttons -->
          <div class="flab-overlay-controls flab-overlay-controls--top-center" aria-label="Quick access controls">
            <button type="button" class="flab-overlay-btn flab-overlay-btn--select" data-mode="select" aria-pressed="true">
              <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#pointer"></use></svg>
              <span>Select</span>
            </button>
            <button type="button" class="flab-overlay-btn flab-overlay-btn--theme-center" id="btnThemeToggleCenter" title="Toggle theme">
              <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#sun"></use></svg>
            </button>
            <button type="button" class="flab-overlay-btn flab-overlay-btn--pass" data-mode="pass">
              <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#pass"></use></svg>
              <span>Pass</span>
            </button>
          </div>

          <!-- Bottom center Tools button -->
          <button type="button" class="flab-controls-tab" id="btnControlsTab" aria-expanded="false" aria-controls="pitchControlsSheet">
            <span class="flab-controls-tab__label">Tools</span>
            <svg aria-hidden="true" focusable="false" width="16" height="16" viewBox="0 0 16 16">
              <path d="M4 9l4-4 4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <!-- Top right Undo/Redo buttons -->
          <!-- Undo button -->
          <button type="button" class="flab-undo-redo-btn flab-undo-redo-btn--undo" id="btnUndo" title="Undo (Ctrl+Z)">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#undo"></use></svg>
          </button>

          <!-- Redo button -->
          <button type="button" class="flab-undo-redo-btn flab-undo-redo-btn--redo" id="btnRedo" title="Redo (Ctrl+Y)">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#redo"></use></svg>
          </button>

          <!-- Erase button -->
          <button type="button" class="flab-undo-redo-btn flab-undo-redo-btn--erase" id="btnErase" data-mode="erase" title="Erase">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#erase"></use></svg>
          </button>

          <!-- Bottom right fullscreen button (like YouTube) -->
          <button type="button" class="flab-fullscreen-btn-corner" id="btnFullscreenCorner" title="Fullscreen">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#expand"></use></svg>
          </button>

          <aside class="flab-controls-sheet" id="pitchControlsSheet" aria-hidden="true">
            <section class="flab-sidepanel" aria-label="Formation Lab controls">
              <header class="flab-header">
                <div class="flab-header__top">
                  <h1 class="flab-title">Formation Lab <span class="flab-badge">v23.4.7.1</span></h1>
                </div>
                <p class="flab-subtitle">Design youth soccer drills with drag, pass arrows, and instant exports.</p>
              </header>
              <div class="flab-actions" aria-label="Primary actions">
                <div class="actions-row">
                  <button type="button" class="flab-action" id="exportButton" title="Export formation as PNG">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#export"></use></svg>
                    <span>Export</span>
                  </button>
                  <button type="button" class="flab-action" id="resetButton" title="Reset to 4-3-3">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#reset"></use></svg>
                    <span>Reset</span>
                  </button>
                  <button type="button" class="flab-action flab-action--help" id="helpButton" aria-haspopup="dialog" aria-expanded="false" title="Help">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#help"></use></svg>
                    <span>Help</span>
                  </button>
                </div>
                <button type="button" class="flab-action" id="btnPassStyle" aria-haspopup="menu" aria-expanded="false" title="Pass style">
                  <span class="passstyle-trigger__name">Pass Style:</span>
                  <span class="passstyle-value">Solid</span>
                  <svg class="passstyle-trigger__chevron" aria-hidden="true" focusable="false" width="10" height="6" viewBox="0 0 10 6">
                    <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                  </svg>
                </button>
                <div class="actions-row actions-row--three">
                  <button type="button" class="flab-action flab-action--sm" id="btnSavePreset" title="Save current formation">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#save-preset"></use></svg>
                  </button>
                  <button type="button" class="flab-action flab-action--sm" id="btnApplyDefault" title="Apply default preset">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#apply-preset"></use></svg>
                  </button>
                  <button type="button" class="flab-action flab-action--sm" id="btnManagePresets" title="Manage presets">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#manage-presets"></use></svg>
                  </button>
                </div>
                <div id="passPlaybackControls" style="display: none;" class="actions-row actions-row--four">
                  <button type="button" class="flab-action flab-action--sm" id="btnPlayLast" disabled title="Play last pass">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#play"></use></svg>
                  </button>
                  <button type="button" class="flab-action flab-action--sm" id="btnPlayAll" disabled title="Play all passes">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#skip-back"></use></svg>
                  </button>
                  <button type="button" class="flab-action flab-action--sm" id="btnStopPlayback" disabled title="Stop playback">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#stop"></use></svg>
                  </button>
                  <button type="button" class="flab-action flab-action--sm" id="btnDiagnostics" title="Diagnostics">
                    <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#diagnostic"></use></svg>
                  </button>
                </div>
                <button type="button" class="flab-action flab-action--share-compact" id="btnShareToggle" title="Share formation">
                  <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#share"></use></svg>
                  <span>Share</span>
                </button>
              </div>
            </section>
          </aside>
        </div>
        <!-- Share menu - floats over pitch -->
        <div class="flab-share-menu" id="shareMenu" style="display: none;">
          <a href="#" class="flab-share-link" id="shareFacebook" title="Share on Facebook">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#facebook"></use></svg>
          </a>
          <a href="#" class="flab-share-link" id="shareTwitter" title="Share on Twitter">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#twitter"></use></svg>
          </a>
          <a href="#" class="flab-share-link" id="shareLinkedin" title="Share on LinkedIn">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#linkedin"></use></svg>
          </a>
          <a href="#" class="flab-share-link" id="shareInstagram" title="Share on Instagram">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#instagram"></use></svg>
          </a>
          <a href="#" class="flab-share-link" id="shareEmail" title="Share via Email">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#mail"></use></svg>
          </a>
          <a href="#" class="flab-share-link" id="shareCopy" title="Copy share link">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#link"></use></svg>
          </a>
          <a href="#" class="flab-share-link" id="shareQR" title="QR code">
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#qr-code"></use></svg>
          </a>
        </div>
      </section>
    </main>

    <section class="flab-help" id="helpOverlay" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="helpTitle">
      <div class="flab-help__content">
        <header>
          <h2 id="helpTitle">Formation Lab Help</h2>
          <button type="button" class="flab-help__close" id="closeHelpButton">
            <span class="sr-only">Close help</span>
            <svg aria-hidden="true" focusable="false"><use href="assets/icons.svg#close"></use></svg>
          </button>
        </header>
        <article>
          <p>Drag players to plan drills. Switch to Pass mode and drag to draw crisp pass arrows. Hold Alt while drawing for curved passes. Export captures the full pitch at display resolution.</p>
          <ul>
            <li>Tokens are keyboard accessible: Tab, Enter, and arrow keys nudge positions.</li>
            <li>Alt + drag creates curved passes with live handles.</li>
            <li>Esc cancels drags or closes this help panel.</li>
            <li>Reset restores the default 4-3-3 formation.</li>
          </ul>
        </article>
      </div>
    </section>

    <!-- Emergency SW bypass: ?sw=off temporarily disables service worker -->
    <script>
      if (new URL(location).searchParams.get('sw') === 'off') {
        navigator.serviceWorker?.getRegistrations().then(registrations => {
          registrations.forEach(reg => reg.unregister());
          console.log('ðŸš¨ Service Worker disabled via ?sw=off');

          // Show toast notification
          setTimeout(() => {
            const toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#ff6b6b;color:white;padding:12px 16px;border-radius:8px;z-index:9999;font-family:sans-serif;font-size:14px;';
            toast.textContent = 'ðŸš¨ Offline caching disabled';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
          }, 100);
        });
      }
    </script>

    <!-- Development mode: use /scripts/* directly. Production: run `npm run build` and switch to /dist/scripts/* -->
    <!-- UI portal for floating menus/popovers -->
    <div id="ui-portal" class="ui-portal"></div>

    <script src="scripts/version.js?v=23.4.7.2" defer></script>
    <script type="module" src="scripts/main.js?v=23.4.7.2"></script>
  </body>
</html>
